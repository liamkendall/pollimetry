---
title: 'Pollinator size and its consequences: Predictive allometry for pollinating insects'
author: Liam K. Kendall1,2*, Romina Rader1, Vesna Gagic2, Daniel Cariveau3, Matthias Albrecht4, Katherine C.R. Baldock5, Breno Freitas6, Mark Hall1, Andrea Holzschuh7, Janeally Pereira6, Stuart P.M. Roberts8, Juanita Rodriguez9, Laura Russo10, Louis Sutter4, Nicolas J. Vereecken11 and Ignasi Bartomeus12
date: "17/06/2018"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
editor_options: 
  chunk_output_type: console
---

This markdown file has all code from the MS so you can look over it, notice any issues/mistakes and make changes :)

#Data preparation
```{r setup, include=FALSE}  
knitr::opts_chunk$set(echo = TRUE)
library(ape)
library(broom)
library(brms)
library(cvTools)
library(caret)
library(grid)
library(gridExtra)
library(lme4)
library(MCMCglmm)
library(ModelMetrics)
library(MuMIn)
library(nlme)
library(foreign)
library(compiler)
library(parallel)
library(phytools)
library(plyr)
library(dplyr)
library(stargazer)
library(tidyverse)

#dataframe
set.seed(123)
poll_all <- read.csv(file="data/PA170618.csv",header=T)
head(poll_all)

#split to bees and hoverflies
poll_all$Spec.wgt=poll_all$Spec.wgt*1000
poll_all_split=split(poll_all,poll_all$Superfamily)
bee_all=poll_all_split[[1]]
hov_all=poll_all_split[[2]]

#JUST AUSTRALIA
bee_country=split(bee_all,bee_all$Country)
bee_australia=bee_country$Australia

bee_all$Family=droplevels(relevel(bee_all$Family,ref="Apidae"))
bee_all$Region=droplevels(relevel(bee_all$Region,ref="Europe"))
bee_all$Species=droplevels(bee_all$Species)

##BEE mean dataframe
bee_mean=aggregate(Latitude~Family+Subfamily+Tribe+Region+Subfamily+Genus+Species+Sex,bee_all,mean)
bee_mean$Spec.wgt=as.numeric(unlist(aggregate(Spec.wgt~Family+Subfamily+Tribe+Region+
                                                Subfamily+Genus+Species+Sex,bee_all,mean)[8]))
bee_mean$IT=(as.numeric(unlist(aggregate(IT~Family+Subfamily+Tribe+Region+
                                           Subfamily+Genus+Species+Sex,bee_all,mean)[8])))

bee_mean=bee_mean[!bee_mean$Species=="Flavipanurgus_venustus",] #Why exclude this species? - not in phylogeny
bee_mean=bee_mean[!bee_mean$Species=="Protomeliturga_turnerea",] #not in phylogeny
bee_mean=bee_mean[!bee_mean$Species=="Tetrapedia_diversipes",] # not in phylogeny

#for complete nestedness
bee_mean=bee_mean[!(bee_mean$Species=="Andrena_wilkella" & bee_mean$Region=="NorthAmerica"),] #(Hurd (1979) presumes it is an #introduction in North America)
bee_mean=bee_mean[!(bee_mean$Species=="Halictus_rubicundus" & bee_mean$Region=="NorthAmerica"),]
bee_mean=bee_mean[!(bee_mean$Species=="Lasioglossum_leucozonium" & bee_mean$Region=="NorthAmerica"),]
bee_mean=bee_mean[!(bee_mean$Species=="Anthidium_manicatum" & bee_mean$Region=="NorthAmerica"),]
bee_mean=bee_mean[!(bee_mean$Species=="Apis_mellifera" & bee_mean$Region=="Australasia"),]


#bee_mean=bee_mean[-344,] #HAlictus NA
#bee_mean=bee_mean[-49,] # APIS AUS
bee_mean$Species=droplevels(bee_mean$Species)
bee_mean$animal=bee_mean$Species
bee_mean$Region=relevel(bee_mean$Region,ref="Europe")
bee_mean$Family=droplevels(relevel(bee_mean$Family,ref="Apidae"))

##HOV mean dataframe
hov_mean=aggregate(Latitude~Family+Tribe+
                     Region+Subfamily+Genus+Species+Sex,hov_all,mean)
hov_mean$Spec.wgt=as.numeric(unlist(aggregate(Spec.wgt~Family+Tribe+
                                                Region+Subfamily+
                                                Genus+Species+Sex,hov_all,mean)[8]))
hov_mean$IT=as.numeric(unlist(aggregate(IT~Family+Tribe+
                                          Region+Subfamily+                                    Genus+Species+Sex,hov_all,mean)[8]))
hov_mean$Subfamily=droplevels(hov_mean$Subfamily)
hov_mean$Region=droplevels(hov_mean$Region)
hov_mean$Region=relevel(hov_mean$Region,ref="Europe")

##PHYLO Dataframe -obsolete (except for phylogeny)

bee_phylo=aggregate(Latitude~Family+Subfamily+
                      Tribe+Genus+Species,bee_all,median)
bee_phylo$Longitude=as.numeric(unlist(aggregate(Longitude~Family+Subfamily+
                                                  Tribe+Genus+Species,bee_all,median)[6]))
bee_phylo$Spec.wgt=as.numeric(unlist(aggregate(Spec.wgt~Family+Subfamily+
                                                 Tribe+Genus+Species,bee_all,mean)[6]))
bee_phylo$Wgt.SD=as.numeric(unlist(aggregate(log(Spec.wgt)~Family+Subfamily+
                                               Tribe+Genus+Species,bee_all,sd)[6]))
bee_phylo$IT=as.numeric(unlist(aggregate(IT~Family+Subfamily+
                                           Tribe+Genus+Species,bee_all,mean)[6]))
bee_phylo$IT.SD=as.numeric(unlist(aggregate(log(IT)~Family+Subfamily+
                                              Tribe+Genus+Species,bee_all,sd)[6]))

bee_phylo=bee_phylo[!bee_phylo$Species=="Flavipanurgus_venustus",]
bee_phylo=bee_phylo[!bee_phylo$Species=="Protomeliturga_turnerea",]
bee_phylo=bee_phylo[!bee_phylo$Species=="Tetrapedia_diversipes",]

rownames(bee_phylo)=droplevels(bee_phylo$Species)

#Tree for MCMC

bee.trees=read.tree(file="data/hedtke_genera_tree.txt")
##Use tree 1 (376 genera) #Genera-level phylogney
bee.mcmc=bee.trees[[1]]

bee.mcmc=as.phylo(bee.mcmc)

bee.mcmc=root(bee.mcmc,outgroup="Tachysphex")

species=unique(as.character(bee_mean$Species))

bee.tree=drop.tip(bee.mcmc, setdiff(bee.mcmc$tip.label,unique(bee_mean$Genus)))

bee.tree=genus.to.species.tree(bee.tree, species=species)

bee.tree=chronoMPL(bee.tree)

bee.tree$edge.length[bee.tree$edge.length <0]=0.000001

bee.tree=force.ultrametric(bee.tree,"extend")
bee.tree$node.label=NULL
plot(bee.tree)

##Intraspecific variance data frames
bee_species=split(bee_all,bee_all$Species)
hov_species=split(hov_all,hov_all$Species)

#Preservative time data frame

#JUST AUST and GER
bee_country=split(bee_all,bee_all$Country)
bee_pres=rbind(bee_country$Australia,bee_country$Germany)

#Filter so only species with more than 1 preservative time
bee_pres=as.data.frame(bee_pres %>%
  group_by(Species) %>% 
  filter(n_distinct(Pres.time)>1))

##Cane function
Cane=function(IT){exp(0.6453 + 2.4691*log(IT))}

###FOLDS

#bees
bfold <- createFolds(bee_mean$Region, k=10)
names(bfold)=c('1','2','3','4','5','6','7','8','9','10')
bfold=ldply(bfold, data.frame)
colnames(bfold)=c("which","subsets")

#hoverflies
hov_fold <- createFolds(hov_mean$Region, k=10)
names(hov_fold)=c('1','2','3','4','5','6','7','8','9','10')
hov_fold=ldply(hov_fold, data.frame)
colnames(hov_fold)=c("which","subsets")

##FOR IND SPECIES ANALYSES
bee_species=split(bee_all,bee_all$Species)
```

##Model compilation 
```{r}
#BEE TAX MODELS

bee_lm1=lmer(log(Spec.wgt) ~ log(IT)  + Family + 
  Sex + #fix factors
  log(IT):Family  + log(IT):Sex+(1|Region/Species),bee_mean)
options(na.action = "na.fail")
bee_models=get.models(dredge(bee_lm1,fixed=c("log(IT)","Family")),subset=TRUE)

names(bee_models)=as.character(rep(1:6,1))
names(bee_models)

#PHY MODELS
bee_phy_lm1=lmer(log(Spec.wgt) ~ log(IT) + 
             Sex + log(IT):Sex+(1|Region/Species),bee_mean)
bee_phy_models=get.models(dredge(bee_phy_lm1,fixed=c("log(IT)")),subset=TRUE)

names(bee_phy_models)=as.character(rep(1:3,1))
names(bee_phy_models)

#HOV MODELS
hov_lm1=lmer(log(Spec.wgt) ~ log(IT)  + Subfamily + 
             Sex + #fix factors
             log(IT):Subfamily + log(IT):Sex+(1|Region/Species),hov_mean)
options(na.action = "na.fail")
hov_models=get.models(dredge(hov_lm1,fixed=c("log(IT)")),subset=TRUE)
names(hov_models)=as.character(rep(1:9,1))
names(hov_models)

```

##BRMS bee models and manual selection
Test OLS models w. biogeography
```{r bee biog model} 

##SET NORMAL FLAT PRIORS FOR BOTH Bs and Random Terms
bprior1 <- prior(normal(1,3), class = b) + 
  prior(normal(0,1), class = sd) #based off what I observed using default priors, 
                                 #this improved posteriors of bee_model1 - the full model


bee1<- brm(formula(bee_models$'1'), data = bee_mean, cores=3,
  family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1,
  control = list(adapt_delta = 0.99))
#0 divergent transitions GOOD

bee2<- brm(formula(bee_models$'2'), data = bee_mean, cores=3,
           family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99,max_treedepth=15))

##10 divergent transitions - gone with increased treedepth

bee3<- brm(formula(bee_models$'3'), data = bee_mean, cores=3,
           family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1
           ,control = list(adapt_delta = 0.99,max_treedepth=15))
#4 divergent transitions - gone with increased treedepth

bee4<- brm(formula(bee_models$'4'), data = bee_mean, cores=3,
           family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1
           ,control = list(adapt_delta = 0.99))
#GOOD

bee5<- brm(formula(bee_models$'5'), data = bee_mean, cores=3,
           family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1
           ,control = list(adapt_delta = 0.99))

#good

bee6<- brm(formula(bee_models$'6'), data = bee_mean, cores=3,
           family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1
           ,control = list(adapt_delta = 0.99))


bee7<- brm(log(Spec.wgt)~log(IT)+(1|Region/Species), data = bee_mean, cores=3,
           family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1
           ,control = list(adapt_delta = 0.99))
plot(bee7)
#good
```

#BEE PHYLO models
```{r}
##BEE_PHYLO STRUCTURE

####
##phylo structure for brms
inv.phylo <- MCMCglmm::inverseA(bee.tree, nodes = "TIPS", scale = TRUE)
A <- solve(inv.phylo$Ainv)
rownames(A) <- rownames(inv.phylo$Ainv)
isSymmetric(A, check.attributes = FALSE)

#nested
B=A
bee_mean$Rspecies=paste(bee_mean$Region,bee_mean$Species,sep="_")
region_species=unique(bee_mean[ order(match(bee_mean$Species, bee.tree$tip.label)), ]$Rspecies)
rownames(B)=unique(region_species)
isSymmetric(B,check.attributes=FALSE)

bee_p1<- brm(formula(bee_phy_models$'1'), data = bee_mean, cores=3,
           family = gaussian(),cov_ranef = list("Region:Species" = B),prior=bprior1
           ,iter=11000,warmup=1000,thin=10,control = list(adapt_delta = 0.99))
plot(bee_p1)
#good

bee_p2<- brm(formula(bee_phy_models$'2'), data = bee_mean,prior=bprior1, cores=3,
           family = gaussian(),cov_ranef = list("Region:Species" = B)
           ,iter=11000,warmup=1000,thin=10,control = list(adapt_delta = 0.99))
#good

bee_p3<- brm(formula(bee_phy_models$'3'), data = bee_mean,prior=bprior1, cores=3,
           family = gaussian(),cov_ranef = list("Region:Species" = B),
           iter=11000,warmup=1000,thin=10,control = list(adapt_delta = 0.99,max_treedepth=15))

```
#Hoverfly model selection
Test w. biogeography
```{r}
###HOVERFLY MODELS

hov1<- brm(formula(hov_models$'1'), data = hov_mean, cores=3,
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99))
#good

hov2<- brm(formula(hov_models$'2'), data = hov_mean,  cores=3,
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99,max_treedepth=15))
#3 divergent - gone with increased treedepth

hov3<- brm(formula(hov_models$'3'), data = hov_mean,  cores=3,
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99))
#good

hov4<- brm(formula(hov_models$'4'), data = hov_mean,  cores=3,
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99))
#good

hov5<- brm(formula(hov_models$'5'), data = hov_mean,  cores=3,
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99,max_treedepth=15))

#4 divergent transitions - gone with increased treedepth

hov6<- brm(formula(hov_models$'6'), data = hov_mean,  cores=3,
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99))
#good

hov7<- brm(formula(hov_models$'7'), data = hov_mean,  cores=3,
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.999,max_treedepth=20))
#5 divergent transitions, 1 with treedepth 15 and 20, 
#reduced stepsize (0.1) made it worse, gone with delta 0.999

hov8<- brm(formula(hov_models$'8'), data = hov_mean,  cores=3,
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99,max_treedepth=15))
#1 divergent transition - gone with increased treedepth 15

hov9<- brm(formula(hov_models$'9'), data = hov_mean,  cores=3,
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.999,max_treedepth=20))
#4 divergent transitions, increaed delta 0.999, treedepth 20 - fixed

```

###ADD IC
```{r}

#bee_mcmc_list=list(bee1,bee2,bee3,bee4,bee5,bee6,bee7,bee_p1,bee_p2,bee_p3)
#bee_mcmc_list=mclapply(bee_mcmc_list, function(x) add_ic(x,ic=c("kfold","waic","R2"))) #CURRENTLY TAKES 48 hours

#hov_mcmc_list=list(hov1,hov2,hov3,hov4,hov5,hov6,hov7,hov8,hov9)
#hov_mcmc_list=mclapply(hov_mcmc_list, function(x) add_ic(x,ic=c("kfold","waic","R2")))

```

##Phylo signal

#Weight
```{r,Spec.wgt}
WGT=as.data.frame(bee_phylo[,c("Spec.wgt")])
str(WGT)
WGT=log(WGT)
rownames(WGT)=rownames(bee_phylo)
WGT<-as.matrix((WGT))[,1]
phylosig(tree=bee.tree,x=WGT,method="lambda",test=TRUE)
```

#Model co-efficients
#Bees

##Model validation - k-fold cross validation

#Collate Bayesian R2, K-FOLD-IC and RMSE
```{r}
bee_ics=rbind(cbind(median(bee_mcmc_list[[1]]$R2),
median(bee_mcmc_list[[2]]$R2),
median(bee_mcmc_list[[3]]$R2),
median(bee_mcmc_list[[4]]$R2),
median(bee_mcmc_list[[5]]$R2),
median(bee_mcmc_list[[6]]$R2),
median(bee_mcmc_list[[7]]$R2),
median(bee_mcmc_list[[8]]$R2),
median(bee_mcmc_list[[9]]$R2),
median(bee_mcmc_list[[10]]$R2)),

cbind(bee_mcmc_list[[1]]$kfold$estimates[3,1],
bee_mcmc_list[[2]]$kfold$estimates[3,1],
bee_mcmc_list[[3]]$kfold$estimates[3,1],
bee_mcmc_list[[4]]$kfold$estimates[3,1],
bee_mcmc_list[[5]]$kfold$estimates[3,1],
bee_mcmc_list[[6]]$kfold$estimates[3,1],
bee_mcmc_list[[7]]$kfold$estimates[3,1],
bee_mcmc_list[[8]]$kfold$estimates[3,1],
bee_mcmc_list[[9]]$kfold$estimates[3,1],
bee_mcmc_list[[10]]$kfold$estimates[3,1]),

cbind(
  rmse(exp(predict(bee_mcmc_list[[1]],newdata = bee_mean)[,1]),bee_mean$Spec.wgt),
  rmse(exp(predict(bee_mcmc_list[[2]],newdata = bee_mean)[,1]),bee_mean$Spec.wgt),
  rmse(exp(predict(bee_mcmc_list[[3]],newdata = bee_mean)[,1]),bee_mean$Spec.wgt),
  rmse(exp(predict(bee_mcmc_list[[4]],newdata = bee_mean)[,1]),bee_mean$Spec.wgt),
  rmse(exp(predict(bee_mcmc_list[[5]],newdata = bee_mean)[,1]),bee_mean$Spec.wgt),
  rmse(exp(predict(bee_mcmc_list[[6]],newdata = bee_mean)[,1]),bee_mean$Spec.wgt),
  rmse(exp(predict(bee_mcmc_list[[7]],newdata = bee_mean)[,1]),bee_mean$Spec.wgt),
  rmse(exp(predict(bee_mcmc_list[[8]],newdata = bee_mean)[,1]),bee_mean$Spec.wgt),
  rmse(exp(predict(bee_mcmc_list[[9]],newdata = bee_mean)[,1]),bee_mean$Spec.wgt),
  rmse(exp(predict(bee_mcmc_list[[10]],newdata = bee_mean)[,1]),bee_mean$Spec.wgt)))

write.csv(bee_ics,"bee_ics.csv")

hov_ics=rbind(
cbind(median(hov_mcmc_list[[1]]$R2),
      median(hov_mcmc_list[[2]]$R2),
      median(hov_mcmc_list[[3]]$R2),
      median(hov_mcmc_list[[4]]$R2),
      median(hov_mcmc_list[[5]]$R2),
      median(hov_mcmc_list[[6]]$R2),
      median(hov_mcmc_list[[7]]$R2),
      median(hov_mcmc_list[[8]]$R2),
      median(hov_mcmc_list[[9]]$R2)),

cbind(hov_kfold_list[[1]]$estimates[3,1],
      hov_kfold_list[[2]]$estimates[3,1],
      hov_kfold_list[[3]]$estimates[3,1],
      hov_kfold_list[[4]]$estimates[3,1],
      hov_kfold_list[[5]]$estimates[3,1],
      hov_kfold_list[[6]]$estimates[3,1],
      hov_kfold_list[[7]]$estimates[3,1],
      hov_kfold_list[[8]]$estimates[3,1],
      hov_kfold_list[[9]]$estimates[3,1]),cbind(rmse(exp(predict(hov1)[,1]),hov_mean$Spec.wgt),
                                                rmse(exp(predict(hov2)[,1]),hov_mean$Spec.wgt),
                                                rmse(exp(predict(hov3)[,1]),hov_mean$Spec.wgt),
                                                rmse(exp(predict(hov4)[,1]),hov_mean$Spec.wgt),
                                                rmse(exp(predict(hov5)[,1]),hov_mean$Spec.wgt),
                                                rmse(exp(predict(hov6)[,1]),hov_mean$Spec.wgt),
                                                rmse(exp(predict(hov7)[,1]),hov_mean$Spec.wgt),
                                                rmse(exp(predict(hov8)[,1]),hov_mean$Spec.wgt),
                                                rmse(exp(predict(hov9)[,1]),hov_mean$Spec.wgt)))

write.csv(hov_ics,"hov_ics.csv")


```

#K-fold cross validation RMSE
#IF included needs to be re-done with brm

```{r, bees}  

##Model1
model1<-bee_mean%>%mutate(Fold=rep(0,nrow(bee_mean)),
                          holdoutpred=rep(0,nrow(bee_mean)),
  MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),
 R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
  for(i in 1:10){
    train=model1[bfold$subsets[bfold$which != i], ]
    validation=model1[bfold$subsets[bfold$which == i], ]
    newlm=brm(formula(bee_models$'1'), data = train,cores=3,
  family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1,
  control = list(adapt_delta = 0.99))
    newpred=exp(predict(newlm,newdata=validation))
    true=(validation$Spec.wgt)
    error=(true-newpred)
    rmse=sqrt(mean(error^2))
    mse=mean((newpred-true)^2)
    R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
    mae=mean(abs(error))
    model1[bfold$subsets[bfold$which == i], ]$holdoutpred <- newpred
    model1[bfold$subsets[bfold$which == i], ]$RMSE=rmse
    model1[bfold$subsets[bfold$which == i], ]$MSE=mse
    model1[bfold$subsets[bfold$which == i], ]$MAE=mae
    model1[bfold$subsets[bfold$which == i], ]$R2=R2
    model1[bfold$subsets[bfold$which == i], ]$DIC=DIC(newlm)
    model1[bfold$subsets[bfold$which == i], ]$BIC=BIC(newlm)
    model1[bfold$subsets[bfold$which == i], ]$Fold=i
  }
model1%>%select(.,14:19)%>%map_dbl(mean,na.rm=T)

##Model 2
model2<-bee_mean%>%mutate(Fold=rep(0,nrow(bee_mean)),holdoutpred=rep(0,nrow(bee_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=model2[bfold$subsets[bfold$which != i], ]
  validation=model2[bfold$subsets[bfold$which == i], ]
  newlm=brm(formula(bee_models$'2'), data = train,cores=3,
           family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99,max_treedepth=15))
  newpred=exp(predict(newlm,newdata=validation))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  model2[bfold$subsets[bfold$which == i], ]$holdoutpred <- newpred
  model2[bfold$subsets[bfold$which == i], ]$RMSE=rmse
  model2[bfold$subsets[bfold$which == i], ]$MSE=mse
  model2[bfold$subsets[bfold$which == i], ]$MAE=mae
  model2[bfold$subsets[bfold$which == i], ]$R2=R2
  model2[bfold$subsets[bfold$which == i], ]$DIC=DIC(newlm)
  model2[bfold$subsets[bfold$which == i], ]$BIC=BIC(newlm)
  model2[bfold$subsets[bfold$which == i], ]$Fold=i
}
model2%>%select(.,14:19)%>%map_dbl(median,na.rm=T)


##Model 3
model3<-bee_mean%>%mutate(Fold=rep(0,nrow(bee_mean)),holdoutpred=rep(0,nrow(bee_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=model3[bfold$subsets[bfold$which != i], ]
  validation=model3[bfold$subsets[bfold$which == i], ]
  newlm=brm(formula(bee_models$'3'), data = train,cores=3,
           family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1
           ,control = list(adapt_delta = 0.99,max_treedepth=15))
  newpred=exp(predict(newlm,newdata=validation))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  model3[bfold$subsets[bfold$which == i], ]$holdoutpred <- newpred
  model3[bfold$subsets[bfold$which == i], ]$RMSE=rmse
  model3[bfold$subsets[bfold$which == i], ]$MSE=mse
  model3[bfold$subsets[bfold$which == i], ]$MAE=mae
  model3[bfold$subsets[bfold$which == i], ]$R2=R2
  model3[bfold$subsets[bfold$which == i], ]$DIC=DIC(newlm)
  model3[bfold$subsets[bfold$which == i], ]$BIC=BIC(newlm)
  model3[bfold$subsets[bfold$which == i], ]$Fold=i
}
model3%>%select(.,14:19)%>%map_dbl(median,na.rm=T)


##Model 4
model4<-bee_mean%>%mutate(Fold=rep(0,nrow(bee_mean)),holdoutpred=rep(0,nrow(bee_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=model4[bfold$subsets[bfold$which != i], ]
  validation=model4[bfold$subsets[bfold$which == i], ]
  newlm=brm(formula(bee_models$'4'), data = train,cores=3,
           family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1
           ,control = list(adapt_delta = 0.99))
  newpred=exp(predict(newlm,newdata=validation))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  model4[bfold$subsets[bfold$which == i], ]$holdoutpred <- newpred
  model4[bfold$subsets[bfold$which == i], ]$RMSE=rmse
  model4[bfold$subsets[bfold$which == i], ]$MSE=mse
  model4[bfold$subsets[bfold$which == i], ]$MAE=mae
  model4[bfold$subsets[bfold$which == i], ]$R2=R2
  model4[bfold$subsets[bfold$which == i], ]$DIC=DIC(newlm)
  model4[bfold$subsets[bfold$which == i], ]$BIC=BIC(newlm)
  model4[bfold$subsets[bfold$which == i], ]$Fold=i
}
model4%>%select(.,14:19)%>%map_dbl(median,na.rm=T)

##Model 5
model5<-bee_mean%>%mutate(Fold=rep(0,nrow(bee_mean)),holdoutpred=rep(0,nrow(bee_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=model5[bfold$subsets[bfold$which != i], ]
  validation=model5[bfold$subsets[bfold$which == i], ]
  newlm=brm(formula(bee_models$'5'), data = train,cores=3,
           family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1
           ,control = list(adapt_delta = 0.99))
  newpred=exp(predict(newlm,newdata=validation))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  model5[bfold$subsets[bfold$which == i], ]$holdoutpred <- newpred
  model5[bfold$subsets[bfold$which == i], ]$RMSE=rmse
  model5[bfold$subsets[bfold$which == i], ]$MSE=mse
  model5[bfold$subsets[bfold$which == i], ]$MAE=mae
  model5[bfold$subsets[bfold$which == i], ]$R2=R2
  model5[bfold$subsets[bfold$which == i], ]$DIC=DIC(newlm)
  model5[bfold$subsets[bfold$which == i], ]$BIC=BIC(newlm)
  model5[bfold$subsets[bfold$which == i], ]$Fold=i
}
model5%>%select(.,14:19)%>%map_dbl(median,na.rm=T)

##Model 6
model6<-bee_mean%>%mutate(Fold=rep(0,nrow(bee_mean)),holdoutpred=rep(0,nrow(bee_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=model6[bfold$subsets[bfold$which != i], ]
  validation=model6[bfold$subsets[bfold$which == i], ]
  newlm=brm(formula(bee_models$'6'), data = train,cores=3,
           family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1
           ,control = list(adapt_delta = 0.99))
  newpred=exp(predict(newlm,newdata=validation))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  model6[bfold$subsets[bfold$which == i], ]$holdoutpred <- newpred
  model6[bfold$subsets[bfold$which == i], ]$RMSE=rmse
  model6[bfold$subsets[bfold$which == i], ]$MSE=mse
  model6[bfold$subsets[bfold$which == i], ]$MAE=mae
  model6[bfold$subsets[bfold$which == i], ]$R2=R2
  model6[bfold$subsets[bfold$which == i], ]$DIC=DIC(newlm)
  model6[bfold$subsets[bfold$which == i], ]$BIC=BIC(newlm)
  model6[bfold$subsets[bfold$which == i], ]$Fold=i
}
model6%>%select(.,14:19)%>%map_dbl(median,na.rm=T)

##Model 7
model7<-bee_mean%>%mutate(Fold=rep(0,nrow(bee_mean)),holdoutpred=rep(0,nrow(bee_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=model7[bfold$subsets[bfold$which != i], ]
  validation=model7[bfold$subsets[bfold$which == i], ]
  newlm=brm(log(Spec.wgt)~log(IT)+(1|Region/Species), data = train,cores=3,
           family = gaussian(),iter=11000,warmup=1000,thin=10,prior=bprior1
           ,control = list(adapt_delta = 0.99))
  newpred=exp(predict(newlm,newdata=validation))
  true=validation$Spec.wgt
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  model7[bfold$subsets[bfold$which == i], ]$holdoutpred <- newpred
  model7[bfold$subsets[bfold$which == i], ]$RMSE=rmse
  model7[bfold$subsets[bfold$which == i], ]$MSE=mse
  model7[bfold$subsets[bfold$which == i], ]$MAE=mae
  model7[bfold$subsets[bfold$which == i], ]$R2=R2
  model7[bfold$subsets[bfold$which == i], ]$DIC=DIC(newlm)
  model7[bfold$subsets[bfold$which == i], ]$BIC=BIC(newlm)
  model7[bfold$subsets[bfold$which == i], ]$Fold=i
}
model7%>%select(.,14:19)%>%map_dbl(median,na.rm=T)

```

```{r}
#MODEL9 PGLMM1 - FULL MODEL
pglmm1<-bee_mean%>%mutate(Fold=rep(0,nrow(bee_mean)),
                            holdoutpred=rep(0,nrow(bee_mean)),
                            MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),
                            MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),
                            DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=pglmm1[bfold$subsets[bfold$which != i], ]
  validation=pglmm1[bfold$subsets[bfold$which == i], ]
  newlm=brm(formula(bee_phy_models$'1'), data = train,cores=3,
           family = gaussian(),cov_ranef = list("Region:Species" = B),prior=bprior1
           ,iter=11000,warmup=1000,thin=10,control = list(adapt_delta = 0.99))
  newpred=exp(predict(newlm,newdata=validation))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  pglmm1[bfold$subsets[bfold$which == i], ]$holdoutpred <- newpred
  pglmm1[bfold$subsets[bfold$which == i], ]$RMSE=rmse
  pglmm1[bfold$subsets[bfold$which == i], ]$MSE=mse
  pglmm1[bfold$subsets[bfold$which == i], ]$MAE=mae
  pglmm1[bfold$subsets[bfold$which == i], ]$R2=R2
  pglmm1[bfold$subsets[bfold$which == i], ]$DIC=DIC(newlm)
  pglmm1[bfold$subsets[bfold$which == i], ]$BIC=BIC(newlm)
  pglmm1[bfold$subsets[bfold$which == i], ]$Fold=i
}
pglmm1%>%select(.,14:19)%>%map_dbl(median,na.rm=T)

##JUST IT + Sex
pglmm2<-bee_mean%>%mutate(Fold=rep(0,nrow(bee_mean)),holdoutpred=rep(0,nrow(bee_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=pglmm2[bfold$subsets[bfold$which != i], ]
  validation=pglmm2[bfold$subsets[bfold$which == i], ]
  
  newlm=brm(formula(bee_phy_models$'2'), data = train,prior=bprior1,cores=3,
           family = gaussian(),cov_ranef = list("Region:Species" = B)
           ,iter=11000,warmup=1000,thin=10,control = list(adapt_delta = 0.99))
  newpred=exp(predict(newlm,newdata=validation))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  pglmm2[bfold$subsets[bfold$which == i], ]$holdoutpred <- newpred
  pglmm2[bfold$subsets[bfold$which == i], ]$RMSE=rmse
  pglmm2[bfold$subsets[bfold$which == i], ]$MSE=mse
  pglmm2[bfold$subsets[bfold$which == i], ]$MAE=mae
  pglmm2[bfold$subsets[bfold$which == i], ]$R2=R2
  pglmm2[bfold$subsets[bfold$which == i], ]$DIC=DIC(newlm)
  pglmm2[bfold$subsets[bfold$which == i], ]$BIC=BIC(newlm)
  pglmm2[bfold$subsets[bfold$which == i], ]$Fold=i
}

pglmm2%>%select(.,14:19)%>%map_dbl(median,na.rm=T)


##JUST IT AND REGION
pglmm3<-bee_mean%>%mutate(Fold=rep(0,nrow(bee_mean)),holdoutpred=rep(0,nrow(bee_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=pglmm3[bfold$subsets[bfold$which != i], ]
  validation=pglmm3[bfold$subsets[bfold$which == i], ]
  newlm=brm(formula(bee_phy_models$'3'), data = train,prior=bprior1,cores=3,
           family = gaussian(),cov_ranef = list("Region:Species" = B),
           iter=11000,warmup=1000,thin=10,control = list(adapt_delta = 0.99,max_treedepth=15))
  newpred=exp(predict(newlm,newdata=validation))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  pglmm3[bfold$subsets[bfold$which == i], ]$holdoutpred <- newpred
  pglmm3[bfold$subsets[bfold$which == i], ]$RMSE=rmse
  pglmm3[bfold$subsets[bfold$which == i], ]$MSE=mse
  pglmm3[bfold$subsets[bfold$which == i], ]$MAE=mae
  pglmm3[bfold$subsets[bfold$which == i], ]$R2=R2
  pglmm3[bfold$subsets[bfold$which == i], ]$DIC=DIC(newlm)
  pglmm3[bfold$subsets[bfold$which == i], ]$BIC=BIC(newlm)
  pglmm3[bfold$subsets[bfold$which == i], ]$Fold=i
}
pglmm3%>%select(.,14:19)%>%map_dbl(median,na.rm=T)

```
Cane validation sets

```{r}

validation1=model1[bfold$subsets[bfold$which == 1], ]
validation2=model1[bfold$subsets[bfold$which == 2], ]
validation3=model1[bfold$subsets[bfold$which == 3], ]
validation4=model1[bfold$subsets[bfold$which == 4], ]
validation5=model1[bfold$subsets[bfold$which == 5], ]
validation6=model1[bfold$subsets[bfold$which == 6], ]
validation7=model1[bfold$subsets[bfold$which == 7], ]
validation8=model1[bfold$subsets[bfold$which == 8], ]
validation9=model1[bfold$subsets[bfold$which == 9], ]
validation10=model1[bfold$subsets[bfold$which == 10], ]

VC1=Cane(IT=validation1$IT)
VC2=Cane(IT=validation2$IT)
VC3=Cane(IT=validation3$IT)
VC4=Cane(IT=validation4$IT)
VC5=Cane(IT=validation5$IT)
VC6=Cane(IT=validation6$IT)
VC7=Cane(IT=validation7$IT)
VC8=Cane(IT=validation8$IT)
VC9=Cane(IT=validation9$IT)
VC10=Cane(IT=validation10$IT)

VCR1=rmse(VC1,validation1$Spec.wgt)
VCR2=rmse(VC2,validation2$Spec.wgt)
VCR3=rmse(VC3,validation3$Spec.wgt)
VCR4=rmse(VC4,validation4$Spec.wgt)
VCR5=rmse(VC5,validation5$Spec.wgt)
VCR6=rmse(VC6,validation6$Spec.wgt)
VCR7=rmse(VC7,validation7$Spec.wgt)
VCR8=rmse(VC8,validation8$Spec.wgt)
VCR9=rmse(VC9,validation9$Spec.wgt)
VCR10=rmse(VC10,validation10$Spec.wgt)
```

```{r}
K_sets=rbind(
model1%>%dplyr::select(.,14:19)%>%map_dbl(mean,na.rm=T),
model2%>%dplyr::select(.,14:19)%>%map_dbl(mean,na.rm=T),
model3%>%dplyr::select(.,14:19)%>%map_dbl(mean,na.rm=T),
model4%>%dplyr::select(.,14:19)%>%map_dbl(mean,na.rm=T),
model5%>%dplyr::select(.,14:19)%>%map_dbl(mean,na.rm=T),
model6%>%dplyr::select(.,14:19)%>%map_dbl(mean,na.rm=T),
model7%>%dplyr::select(.,14:19)%>%map_dbl(mean,na.rm=T),
model8%>%dplyr::select(.,14:19)%>%map_dbl(mean,na.rm=T),
pglmm1%>%dplyr::select(.,14:19)%>%map_dbl(mean,na.rm=T),
pglmm2%>%dplyr::select(.,14:19)%>%map_dbl(mean,na.rm=T),
pglmm3%>%dplyr::select(.,14:19)%>%map_dbl(mean,na.rm=T),
pglmm4%>%dplyr::select(.,14:19)%>%map_dbl(mean,na.rm=T))
rownames(K_sets)=c("LM1","LM2","LM3","LM4","LM5","LM6","LM7","LM8","PGLMM1","PGLMM2","PGLMM3","PGLMM4")
K_sets=as.data.frame(K_sets)
K_sets

##Combine RMSEs
RMSE_sets=cbind(unique(model1$RMSE),
unique(model2$RMSE),
unique(model3$RMSE),
unique(model4$RMSE),
unique(model5$RMSE),
unique(model6$RMSE),
unique(model7$RMSE),
unique(model8$RMSE),
unique(pglmm1$RMSE),
unique(pglmm2$RMSE),
unique(pglmm3$RMSE),
unique(pglmm4$RMSE),
rbind(VCR1,VCR2,VCR3,VCR4,VCR5,VCR6,VCR7,VCR8,VCR9,VCR10))
colnames(RMSE_sets)=c("LM1","LM2","LM3","LM4","LM5","LM6","LM7","LM_IT","PG1","PG2","PG3","PG_IT","JC87")
RMSE_sets=as.data.frame(RMSE_sets)

colMeans(RMSE_sets[,1:13])


#SD plot

bee_rmse_means=rbind(colMeans(RMSE_sets),sapply(RMSE_sets, sd)/sqrt(10))
bee_rmse_means=t(bee_rmse_means)
colnames(bee_rmse_means)=c("Mean","SEM")
bee_rmse_means=as.data.frame(bee_rmse_means)
bee_rmse_means$Model=factor(rownames(bee_rmse_means),levels=rownames(bee_rmse_means)[order(bee_rmse_means$Mean)])

bee_rmse_plot=ggplot(bee_rmse_means[c("LM1","LM_IT","JC87","PG1","PG_IT"),], aes(x = Model,
                                                               y = Mean)) +
  geom_errorbar(aes(ymin = Mean-SEM,
                    ymax = Mean+SEM),
                width = 0.05, 
                size  = 0.5) +ylim(10,31)+
  geom_point(shape = 1, 
             size  = 2) +
  theme_bw() +
  theme(aspect.ratio=1) +
  ylab("RMSE (mg)")+ggtitle("Bees")

bee_rmse_plot
```

##Hoverflies
```{r,Hoverflies}
#k-fold hoverflies

#MODEL1 IT + Region + Sex
hov_model1<-hov_mean%>%mutate(Fold=rep(0,nrow(hov_mean)),
                              holdoutpred=rep(0,nrow(hov_mean)),
                              MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),
                              MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),
                              DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=hov_model1[hov_fold$subsets[hov_fold$which != i], ]
  validation=hov_model1[hov_fold$subsets[hov_fold$which == i], ]
  newlm=brm(formula(hov_models$'1'), data = train,
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99))
#good
  newpred=exp(predict(newlm,newdata=validation))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  hov_model1[hov_fold$subsets[hov_fold$which == i], ]$holdoutpred <- newpred
  hov_model1[hov_fold$subsets[hov_fold$which == i], ]$RMSE=rmse
  hov_model1[hov_fold$subsets[hov_fold$which == i], ]$MSE=mse
  hov_model1[hov_fold$subsets[hov_fold$which == i], ]$MAE=mae
  hov_model1[hov_fold$subsets[hov_fold$which == i], ]$R2=R2
  hov_model1[hov_fold$subsets[hov_fold$which == i], ]$DIC=DIC(newlm)
  hov_model1[hov_fold$subsets[hov_fold$which == i], ]$BIC=BIC(newlm)
  hov_model1[hov_fold$subsets[hov_fold$which == i], ]$Fold=i
}

##MODEL 2
hov_model2<-hov_mean%>%mutate(Fold=rep(0,nrow(hov_mean)),
                              holdoutpred=rep(0,nrow(hov_mean)),
                              MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),
                              MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),
                              DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=hov_model2[hov_fold$subsets[hov_fold$which != i], ]
  validation=hov_model2[hov_fold$subsets[hov_fold$which == i], ]
  newlm=brm(formula(hov_models$'2'), data = train, cores=3,
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99,max_treedepth=15))
  newpred=exp(predict(newlm,newdata=validation))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  hov_model2[hov_fold$subsets[hov_fold$which == i], ]$holdoutpred <- newpred
  hov_model2[hov_fold$subsets[hov_fold$which == i], ]$RMSE=rmse
  hov_model2[hov_fold$subsets[hov_fold$which == i], ]$MSE=mse
  hov_model2[hov_fold$subsets[hov_fold$which == i], ]$MAE=mae
  hov_model2[hov_fold$subsets[hov_fold$which == i], ]$R2=R2
  hov_model2[hov_fold$subsets[hov_fold$which == i], ]$DIC=DIC(newlm)
  hov_model2[hov_fold$subsets[hov_fold$which == i], ]$BIC=BIC(newlm)
  hov_model2[hov_fold$subsets[hov_fold$which == i], ]$Fold=i
}

##MODEL 3
##Sex
hov_model3<-hov_mean%>%mutate(Fold=rep(0,nrow(hov_mean)),holdoutpred=rep(0,nrow(hov_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=hov_model3[hov_fold$subsets[hov_fold$which != i], ]
  validation=hov_model3[hov_fold$subsets[hov_fold$which == i], ]
  newlm=brm(formula(hov_models$'3'), data = train, cores=3, 
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99))
  newpred=exp(predict(newlm,newdata=validation))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  hov_model3[hov_fold$subsets[hov_fold$which == i], ]$holdoutpred <- newpred
  hov_model3[hov_fold$subsets[hov_fold$which == i], ]$RMSE=rmse
  hov_model3[hov_fold$subsets[hov_fold$which == i], ]$MSE=mse
  hov_model3[hov_fold$subsets[hov_fold$which == i], ]$MAE=mae
  hov_model3[hov_fold$subsets[hov_fold$which == i], ]$R2=R2
  hov_model3[hov_fold$subsets[hov_fold$which == i], ]$DIC=DIC(newlm)
  hov_model3[hov_fold$subsets[hov_fold$which == i], ]$BIC=BIC(newlm)
  hov_model3[hov_fold$subsets[hov_fold$which == i], ]$Fold=i
}

##MODEL 4 - IT + Sex
hov_model4<-hov_mean%>%mutate(Fold=rep(0,nrow(hov_mean)),holdoutpred=rep(0,nrow(hov_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=hov_model4[hov_fold$subsets[hov_fold$which != i], ]
  validation=hov_model4[hov_fold$subsets[hov_fold$which == i], ]
  newlm=brm(formula(hov_models$'4'), data = train, cores=3, 
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99))
  newpred=exp(predict(newlm,newdata=validation))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  hov_model4[hov_fold$subsets[hov_fold$which == i], ]$holdoutpred <- newpred
  hov_model4[hov_fold$subsets[hov_fold$which == i], ]$RMSE=rmse
  hov_model4[hov_fold$subsets[hov_fold$which == i], ]$MSE=mse
  hov_model4[hov_fold$subsets[hov_fold$which == i], ]$MAE=mae
  hov_model4[hov_fold$subsets[hov_fold$which == i], ]$R2=R2
  hov_model4[hov_fold$subsets[hov_fold$which == i], ]$DIC=DIC(newlm)
  hov_model4[hov_fold$subsets[hov_fold$which == i], ]$BIC=BIC(newlm)
  hov_model4[hov_fold$subsets[hov_fold$which == i], ]$Fold=i
}

##MODEL 5 IT + Region
hov_model5<-hov_mean%>%mutate(Fold=rep(0,nrow(hov_mean)),holdoutpred=rep(0,nrow(hov_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=hov_model5[hov_fold$subsets[hov_fold$which != i], ]
  validation=hov_model5[hov_fold$subsets[hov_fold$which == i], ]
  newlm=brm(formula(hov_models$'5'), data = train, cores=3,
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99,max_treedepth=15))
  newpred=exp(predict(newlm,newdata=validation,allow.new.levels=TRUE))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  hov_model5[hov_fold$subsets[hov_fold$which == i], ]$holdoutpred <- newpred
  hov_model5[hov_fold$subsets[hov_fold$which == i], ]$RMSE=rmse
  hov_model5[hov_fold$subsets[hov_fold$which == i], ]$MSE=mse
  hov_model5[hov_fold$subsets[hov_fold$which == i], ]$MAE=mae
  hov_model5[hov_fold$subsets[hov_fold$which == i], ]$R2=R2
  hov_model5[hov_fold$subsets[hov_fold$which == i], ]$DIC=DIC(newlm)
  hov_model5[hov_fold$subsets[hov_fold$which == i], ]$BIC=BIC(newlm)
  hov_model5[hov_fold$subsets[hov_fold$which == i], ]$Fold=i
}

##MODEL 6 IT + Region
hov_model6<-hov_mean%>%mutate(Fold=rep(0,nrow(hov_mean)),holdoutpred=rep(0,nrow(hov_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=hov_model6[hov_fold$subsets[hov_fold$which != i], ]
  validation=hov_model6[hov_fold$subsets[hov_fold$which == i], ]
  newlm=brm(formula(hov_models$'6'), data = train, cores=3, 
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99))
  newpred=exp(predict(newlm,newdata=validation,allow.new.levels=TRUE))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  hov_model6[hov_fold$subsets[hov_fold$which == i], ]$holdoutpred <- newpred
  hov_model6[hov_fold$subsets[hov_fold$which == i], ]$RMSE=rmse
  hov_model6[hov_fold$subsets[hov_fold$which == i], ]$MSE=mse
  hov_model6[hov_fold$subsets[hov_fold$which == i], ]$MAE=mae
  hov_model6[hov_fold$subsets[hov_fold$which == i], ]$R2=R2
  hov_model6[hov_fold$subsets[hov_fold$which == i], ]$DIC=DIC(newlm)
  hov_model6[hov_fold$subsets[hov_fold$which == i], ]$BIC=BIC(newlm)
  hov_model6[hov_fold$subsets[hov_fold$which == i], ]$Fold=i
}

##MODEL 7 IT * Subfamily 
hov_model7<-hov_mean%>%mutate(Fold=rep(0,nrow(hov_mean)),holdoutpred=rep(0,nrow(hov_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=hov_model7[hov_fold$subsets[hov_fold$which != i], ]
  validation=hov_model7[hov_fold$subsets[hov_fold$which == i], ]
  newlm=brm(formula(hov_models$'7'), data = train, cores=3, 
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.999,max_treedepth=20))
  newpred=exp(predict(newlm,newdata=validation,allow.new.levels=TRUE))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  hov_model7[hov_fold$subsets[hov_fold$which == i], ]$holdoutpred <- newpred
  hov_model7[hov_fold$subsets[hov_fold$which == i], ]$RMSE=rmse
  hov_model7[hov_fold$subsets[hov_fold$which == i], ]$MSE=mse
  hov_model7[hov_fold$subsets[hov_fold$which == i], ]$MAE=mae
  hov_model7[hov_fold$subsets[hov_fold$which == i], ]$R2=R2
  hov_model7[hov_fold$subsets[hov_fold$which == i], ]$DIC=DIC(newlm)
  hov_model7[hov_fold$subsets[hov_fold$which == i], ]$BIC=BIC(newlm)
  hov_model7[hov_fold$subsets[hov_fold$which == i], ]$Fold=i
}

##MODEL 8 IT
hov_model8<-hov_mean%>%mutate(Fold=rep(0,nrow(hov_mean)),holdoutpred=rep(0,nrow(hov_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=hov_model8[hov_fold$subsets[hov_fold$which != i], ]
  validation=hov_model8[hov_fold$subsets[hov_fold$which == i], ]
  newlm=brm(formula(hov_models$'8'), data = train, cores=3, 
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.99,max_treedepth=15))
  newpred=exp(predict(newlm,newdata=validation,allow.new.levels=TRUE))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  hov_model8[hov_fold$subsets[hov_fold$which == i], ]$holdoutpred <- newpred
  hov_model8[hov_fold$subsets[hov_fold$which == i], ]$RMSE=rmse
  hov_model8[hov_fold$subsets[hov_fold$which == i], ]$MSE=mse
  hov_model8[hov_fold$subsets[hov_fold$which == i], ]$MAE=mae
  hov_model8[hov_fold$subsets[hov_fold$which == i], ]$R2=R2
  hov_model8[hov_fold$subsets[hov_fold$which == i], ]$DIC=DIC(newlm)
  hov_model8[hov_fold$subsets[hov_fold$which == i], ]$BIC=BIC(newlm)
  hov_model8[hov_fold$subsets[hov_fold$which == i], ]$Fold=i
}

##MODEL 9
hov_model9<-hov_mean%>%mutate(Fold=rep(0,nrow(hov_mean)),holdoutpred=rep(0,nrow(hov_mean)),MSE=rep(0,nrow(.)),RMSE=rep(0,nrow(.)),MAE=rep(0,nrow(.)),R2=rep(0,nrow(.)),DIC=rep(0,nrow(.)),BIC=rep(0,nrow(.)))
for(i in 1:10){
  train=hov_model9[hov_fold$subsets[hov_fold$which != i], ]
  validation=hov_model9[hov_fold$subsets[hov_fold$which == i], ]
  newlm=brm(formula(hov_models$'9'), data = train, cpres=3, 
           family = gaussian(),
           iter=11000,warmup=1000,thin=10,prior=bprior1,
           control = list(adapt_delta = 0.999,max_treedepth=20))
  newpred=exp(predict(newlm,newdata=validation,allow.new.levels=TRUE))
  true=(validation$Spec.wgt)
  error=(true-newpred)
  rmse=sqrt(mean(error^2))
  mse=mean((newpred-true)^2)
  R2=1-(sum((true-newpred)^2)/sum((true-mean(true))^2))
  mae=mean(abs(error))
  hov_model9[hov_fold$subsets[hov_fold$which == i], ]$holdoutpred <- newpred
  hov_model9[hov_fold$subsets[hov_fold$which == i], ]$RMSE=rmse
  hov_model9[hov_fold$subsets[hov_fold$which == i], ]$MSE=mse
  hov_model9[hov_fold$subsets[hov_fold$which == i], ]$MAE=mae
  hov_model9[hov_fold$subsets[hov_fold$which == i], ]$R2=R2
  hov_model9[hov_fold$subsets[hov_fold$which == i], ]$DIC=DIC(newlm)
  hov_model9[hov_fold$subsets[hov_fold$which == i], ]$BIC=BIC(newlm)
  hov_model9[hov_fold$subsets[hov_fold$which == i], ]$Fold=i
}




str(hov_model1)
Hov_K_sets=rbind(
  hov_model1%>%dplyr::select(.,14:19)%>%map_dbl(median,na.rm=T),
  hov_model2%>%dplyr::select(.,14:19)%>%map_dbl(median,na.rm=T),
  hov_model3%>%dplyr::select(.,14:19)%>%map_dbl(median,na.rm=T),
  hov_model4%>%dplyr::select(.,14:19)%>%map_dbl(median,na.rm=T),
  hov_model5%>%dplyr::select(.,14:19)%>%map_dbl(median,na.rm=T),
  hov_model6%>%dplyr::select(.,14:19)%>%map_dbl(median,na.rm=T),
  hov_model7%>%dplyr::select(.,14:19)%>%map_dbl(median,na.rm=T),
  hov_model8%>%dplyr::select(.,14:19)%>%map_dbl(median,na.rm=T),
  hov_model9%>%dplyr::select(.,14:19)%>%map_dbl(median,na.rm=T))
rownames(Hov_K_sets)=c("LM1","LM2","LM3","LM4","LM5","LM6","LM7","LM8","LM9")
Hov_K_sets

##Combine RMSEs
Hov_RMSE_sets=cbind(unique(hov_model1$RMSE),
                unique(hov_model2$RMSE),
                unique(hov_model3$RMSE),
                unique(hov_model4$RMSE),
                unique(hov_model5$RMSE),
                unique(hov_model6$RMSE),
                unique(hov_model7$RMSE),
                unique(hov_model8$RMSE),
                unique(hov_model9$RMSE))
colnames(Hov_RMSE_sets)=c("LM1","LM2","LM3","LM4","LM5","LM6","LM7","LM8","LM9")
Hov_RMSE_sets=as.data.frame(Hov_RMSE_sets)

#Box plots
hov_rmse_means=rbind(colMeans(Hov_RMSE_sets),sapply(Hov_RMSE_sets, sd)/sqrt(10))
hov_rmse_means=t(hov_rmse_means)
colnames(hov_rmse_means)=c("Mean","SEM")
hov_rmse_means=as.data.frame(hov_rmse_means)
hov_rmse_means$Model=factor(rownames(hov_rmse_means),levels=rownames(hov_rmse_means)[order(hov_rmse_means$Mean)])

hov_plot=ggplot(hov_rmse_means, aes(x = Model,
                                                               y = Mean)) +
  geom_errorbar(aes(ymin = Mean-SEM,
                    ymax = Mean+SEM),
                width = 0.05, 
                size  = 0.5) +ylim(0,10)+
  geom_point(shape = 1, 
             size  = 2) +
  theme_bw() +
  theme(aspect.ratio=1) +
  ylab("Error (mg)")+ggtitle("Hoverflies")
hov_plot
```

##Intraspecific predictions and variation

##Body size predictions - just females
```{r}

bee_top10=rbind(bee_species$Homalictus_urbanus[bee_species$Homalictus_urbanus$Sex == "Female",],
               bee_species$Lasioglossum_pauxillum[bee_species$Lasioglossum_pauxillum$Sex == "Female",],
               bee_species$Bombus_terrestris[bee_species$Bombus_terrestris$Sex == "Female",],
               bee_species$Andrena_flavipes[bee_species$Andrena_flavipes$Sex == "Female",],
               bee_species$Lasioglossum_lanarium[bee_species$Lasioglossum_lanarium$Sex == "Female",],
               bee_species$Trigona_spinipes[bee_species$Trigona_spinipes$Sex == "Female",],
bee_species$Lasioglossum_glabriusculum[bee_species$Lasioglossum_glabriusculum$Sex == "Female",],
bee_species$Bombus_lapidarius[bee_species$Bombus_lapidarius$Sex == "Female",],
bee_species$Andrena_nigroaenea[bee_species$Andrena_nigroaenea$Sex == "Female",],
bee_species$Bombus_impatiens[bee_species$Bombus_impatiens$Sex == "Male",])

HU_lm=lm(log(Spec.wgt)~log(IT),data=bee_species$Homalictus_urbanus[bee_species$Homalictus_urbanus$Sex == "Female",])

LP_lm=lm(log(Spec.wgt)~log(IT),data=bee_species$Lasioglossum_pauxillum[bee_species$Lasioglossum_pauxillum$Sex == "Female",])

BT_lm=lm(log(Spec.wgt)~log(IT),bee_species$Bombus_terrestris[bee_species$Bombus_terrestris$Sex == "Female",])

AF_lm=lm(log(Spec.wgt)~log(IT),bee_species$Andrena_flavipes[bee_species$Andrena_flavipes$Sex == "Female",])

LL_lm=lm(log(Spec.wgt)~log(IT),bee_species$Lasioglossum_lanarium[bee_species$Lasioglossum_lanarium$Sex == "Female",])

TS_lm=lm(log(Spec.wgt)~log(IT),bee_species$Trigona_spinipes[bee_species$Trigona_spinipes$Sex == "Female",])

LG_lm=lm(log(Spec.wgt)~log(IT),bee_species$Lasioglossum_glabriusculum[bee_species$Lasioglossum_glabriusculum$Sex == "Female",])

BL_lm=lm(log(Spec.wgt)~log(IT),bee_species$Bombus_lapidarius[bee_species$Bombus_lapidarius$Sex == "Female",])

AN_lm=lm(log(Spec.wgt)~log(IT),bee_species$Andrena_nigroaenea[bee_species$Andrena_nigroaenea$Sex == "Female",])

BI_lm=lm(log(Spec.wgt)~log(IT),bee_species$Bombus_impatiens[bee_species$Bombus_impatiens$Sex == "Male",])

summary(HU_lm)
summary(LP_lm)
summary(BL_lm)
summary(AF_lm)
summary(LL_lm)

summary(TS_lm)
summary(LG_lm)
summary(BL_lm)
summary(AN_lm)
summary(BI_lm)

#HOVERFLIES
hov_top5=rbind(hov_species$Helophilus_parallelus[hov_species$Helophilus_parallelus$Sex == "Female",],
               hov_species$Sphaerophoria_macrogaster[hov_species$Sphaerophoria_macrogaster$Sex == "Female",],
               hov_species$Episyrphus_balteatus[hov_species$Episyrphus_balteatus$Sex == "Female",],
               hov_species$Melanostoma_scalare[hov_species$Melanostoma_scalare$Sex == "Female",],
               hov_species$Austrosyphus_aussp1[hov_species$Austrosyphus_aussp1$Sex == "Female",])

HP_lm=lm(log(Spec.wgt)~log(IT),data=hov_species$Helophilus_parallelus[hov_species$Helophilus_parallelus$Sex == "Female",])

SM_lm=lm(log(Spec.wgt)~log(IT),data=hov_species$Sphaerophoria_macrogaster[hov_species$Sphaerophoria_macrogaster$Sex == "Female",])

EB_lm=lm(log(Spec.wgt)~log(IT),hov_species$Episyrphus_balteatus[hov_species$Episyrphus_balteatus$Sex == "Female",])

MS_lm=lm(log(Spec.wgt)~log(IT),hov_species$Melanostoma_scalare[hov_species$Melanostoma_scalare$Sex == "Female",])

AA_lm=lm(log(Spec.wgt)~log(IT),hov_species$Austrosyphus_aussp1[hov_species$Austrosyphus_aussp1$Sex == "Female",])

summary(HP_lm)
summary(SM_lm)
summary(EB_lm)
summary(MS_lm)
summary(AA_lm)

int_bee1=ggplot(data=bee_top10,aes(y=log(Spec.wgt),x=log(IT),col=Species))+
  geom_point(pch=1)+
  geom_smooth(method="lm",se=FALSE)+labs(x="ITD ln(mm)",y="Dry weight ln(mg)")+
   theme(aspect.ratio=1)+theme_bw()+ggtitle("Bees")
int_hov1=ggplot(data=hov_top5,aes(y=log(Spec.wgt),x=log(IT),col=Species))+
  geom_point(pch=1)+
  geom_smooth(method="lm",se=FALSE)+labs(x="ITD ln(mm)",y="")+
  theme(aspect.ratio=1)+theme_bw()+ggtitle("Hoverflies")
int_bee2=ggplotGrob(int_bee1)
int_hov2=ggplotGrob(int_hov1)
grid.draw(cbind(int_bee2, int_hov2, size = "first"))

```

##Bee intraspecific variation with sample size
```{r,echo=FALSE}
#Andrena flavipes
#Andrena nigroaenea 
#Bombus_impatiens
#Bombus_lapidarius
#Bombus terrestris
#Homalictus urbanus
#Lasioglossum_glabriusculum
#Lasioglossum lanarium
#Lasioglossum pauxillum
#Trigona_spinipes

set.seed(123)
##ONE##
#Homalictus_urbanus
#IT
HU_IT = c()
for(i in 1:length(bee_species$Homalictus_urbanus[bee_species$Homalictus_urbanus$Sex == "Female",]$IT)){
  subset1 = sample(bee_species$Homalictus_urbanus[bee_species$Homalictus_urbanus$Sex == "Female",]$IT, i)
  HU_IT[i] = mean(subset1)
}


#Specimen weight
HU_WT = c()
for(i in 1:length(bee_species$Homalictus_urbanus[bee_species$Homalictus_urbanus$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(bee_species$Homalictus_urbanus[bee_species$Homalictus_urbanus$Sex == "Female",]$Spec.wgt, i)
  HU_WT[i] = mean(subset1)
}


##TWO##

#Lasioglossum_pauxillum
#IT
LP_IT = c()
for(i in 1:length(bee_species$Lasioglossum_pauxillum[bee_species$Lasioglossum_pauxillum$Sex == "Female",]$IT)){
  subset1 = sample(bee_species$Lasioglossum_pauxillum[bee_species$Lasioglossum_pauxillum$Sex == "Female",]$IT, i)
  LP_IT[i] = mean(subset1)
}


#Specimen weight
LP_WT = c()
for(i in 1:length(bee_species$Lasioglossum_pauxillum[bee_species$Lasioglossum_pauxillum$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(bee_species$Lasioglossum_pauxillum[bee_species$Lasioglossum_pauxillum$Sex == "Female",]$Spec.wgt, i)
  LP_WT[i] = mean(subset1)
}


##THREE
#Bombus_lucorum
BT_IT = c()
for(i in 1:length(bee_species$Bombus_terrestris[bee_species$Bombus_terrestris$Sex == "Female",]$IT)){
  subset1 = sample(bee_species$Bombus_terrestris[bee_species$Bombus_terrestris$Sex == "Female",]$IT, i)
  BT_IT[i] = mean(subset1)
}


#Specimen weight
BT_WT = c()
for(i in 1:length(bee_species$Bombus_terrestris[bee_species$Bombus_terrestris$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(bee_species$Bombus_terrestris[bee_species$Bombus_terrestris$Sex == "Female",]$Spec.wgt, i)
  BT_WT[i] = mean(subset1)
}

##FOUR##
#Andrena_flavipes
#IT
AF_IT = c()
for(i in 1:length(bee_species$Andrena_flavipes[bee_species$Andrena_flavipes$Sex == "Female",]$IT)){
  subset1 = sample(bee_species$Andrena_flavipes[bee_species$Andrena_flavipes$Sex == "Female",]$IT, i)
  AF_IT[i] = mean(subset1)
}


#Specimen weight
AF_WT = c()
for(i in 1:length(bee_species$Andrena_flavipes[bee_species$Andrena_flavipes$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(bee_species$Andrena_flavipes[bee_species$Andrena_flavipes$Sex == "Female",]$Spec.wgt, i)
  AF_WT[i] = mean(subset1)
}

##FIVE##
#Lasioglossum_lanarium
LL_IT = c()
for(i in 1:length(bee_species$Lasioglossum_lanarium[bee_species$Lasioglossum_lanarium$Sex == "Female",]$IT)){
  subset1 = sample(bee_species$Lasioglossum_lanarium[bee_species$Lasioglossum_lanarium$Sex == "Female",]$IT, i)
  LL_IT[i] = mean(subset1)
}

#Specimen weight
LL_WT = c()
for(i in 1:length(bee_species$Lasioglossum_lanarium[bee_species$Lasioglossum_lanarium$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(bee_species$Lasioglossum_lanarium[bee_species$Lasioglossum_lanarium$Sex == "Female",]$Spec.wgt, i)
  LL_WT[i] = mean(subset1)
}

##Six##
#Andrena_nigroaenea 
AN_IT = c()
for(i in 1:length(bee_species$Andrena_nigroaenea[bee_species$Andrena_nigroaenea$Sex == "Female",]$IT)){
  subset1 = sample(bee_species$Andrena_nigroaenea[bee_species$Andrena_nigroaenea$Sex == "Female",]$IT, i)
  AN_IT[i] = mean(subset1)
}

#Specimen weight
AN_WT = c()
for(i in 1:length(bee_species$Andrena_nigroaenea[bee_species$Andrena_nigroaenea$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(bee_species$Andrena_nigroaenea[bee_species$Andrena_nigroaenea$Sex == "Female",]$Spec.wgt, i)
  AN_WT[i] = mean(subset1)
}

##Seven##
#Bombus_impatiens 
BI_IT = c()
for(i in 1:length(bee_species$Bombus_impatiens[bee_species$Bombus_impatiens$Sex == "Male",]$IT)){
  subset1 = sample(bee_species$Bombus_impatiens[bee_species$Bombus_impatiens$Sex == "Male",]$IT, i)
  BI_IT[i] = mean(subset1)
}

#Specimen weight
BI_WT = c()
for(i in 1:length(bee_species$Bombus_impatiens[bee_species$Bombus_impatiens$Sex == "Male",]$Spec.wgt)){
  subset1 = sample(bee_species$Bombus_impatiens[bee_species$Bombus_impatiens$Sex == "Male",]$Spec.wgt, i)
  BI_WT[i] = mean(subset1)
}

##Eight##
#Bombus_lapidarius 
BL_IT = c()
for(i in 1:length(bee_species$Bombus_lapidarius[bee_species$Bombus_lapidarius$Sex == "Female",]$IT)){
  subset1 = sample(bee_species$Bombus_lapidarius[bee_species$Bombus_lapidarius$Sex == "Female",]$IT, i)
  BL_IT[i] = mean(subset1)
}

#Specimen weight
BL_WT = c()
for(i in 1:length(bee_species$Bombus_lapidarius[bee_species$Bombus_lapidarius$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(bee_species$Bombus_lapidarius[bee_species$Bombus_lapidarius$Sex == "Female",]$Spec.wgt, i)
  BL_WT[i] = mean(subset1)
}

##Nine##
#Lasioglossum_glabriusculum 
LG_IT = c()
for(i in 1:length(bee_species$Lasioglossum_glabriusculum[bee_species$Lasioglossum_glabriusculum$Sex == "Female",]$IT)){
  subset1 = sample(bee_species$Lasioglossum_glabriusculum[bee_species$Lasioglossum_glabriusculum$Sex == "Female",]$IT, i)
  LG_IT[i] = mean(subset1)
}

#Specimen weight
LG_WT = c()
for(i in 1:length(bee_species$Lasioglossum_glabriusculum[bee_species$Lasioglossum_glabriusculum$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(bee_species$Lasioglossum_glabriusculum[bee_species$Lasioglossum_glabriusculum$Sex == "Female",]$Spec.wgt, i)
  LG_WT[i] = mean(subset1)
}

##Ten##
#Trigona_spinipes 
TS_IT = c()
for(i in 1:length(bee_species$Trigona_spinipes[bee_species$Trigona_spinipes$Sex == "Female",]$IT)){
  subset1 = sample(bee_species$Trigona_spinipes[bee_species$Trigona_spinipes$Sex == "Female",]$IT, i)
  TS_IT[i] = mean(subset1)
}

#Specimen weight
TS_WT = c()
for(i in 1:length(bee_species$Trigona_spinipes[bee_species$Trigona_spinipes$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(bee_species$Trigona_spinipes[bee_species$Trigona_spinipes$Sex == "Female",]$Spec.wgt, i)
  TS_WT[i] = mean(subset1)
}

par(pty="s")
par(mfrow=c(4,5))

#Andrena flavipes
#Andrena nigroaenea 
#Bombus_impatiens
#Bombus_lapidarius
#Bombus terrestris
#Homalictus urbanus
#Lasioglossum_glabriusculum
#Lasioglossum lanarium
#Lasioglossum pauxillum
#Trigona_spinipes
par(mfrow=c(4,5),pty="s")
#1
plot(AF_IT,main="Andrena flavipes",ylab = "ITD (mm)",xlab="")
abline(a=AF_IT[72],b=0,col=2)
abline(a=confint(lm(bee_species$Andrena_flavipes[bee_species$Andrena_flavipes$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Andrena_flavipes[bee_species$Andrena_flavipes$Sex == "Female",]$IT~1))[2],b=0,col=3)

#2
plot(AN_IT,main="Andrena nigroaenea",ylab = "",xlab="")
abline(a=AN_IT[52],b=0,col=2)
abline(a=confint(lm(bee_species$Andrena_nigroaenea[bee_species$Andrena_nigroaenea$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Andrena_nigroaenea[bee_species$Andrena_nigroaenea$Sex == "Female",]$IT~1))[2],b=0,col=3)
#3
plot(BI_IT,main="Bombus impatiens",ylab = "",xlab="")
abline(a=BI_IT[68],b=0,col=2)
abline(a=confint(lm(bee_species$Bombus_impatiens[bee_species$Bombus_impatiens$Sex == "Male",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Bombus_impatiens[bee_species$Bombus_impatiens$Sex == "Male",]$IT~1))[2],b=0,col=3)
#4
plot(BL_IT,main="Bombus_lapidarius",ylab = "",xlab="")
abline(a=BL_IT[56],b=0,col=2)
abline(a=confint(lm(bee_species$Bombus_lapidarius[bee_species$Bombus_lapidarius$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Bombus_lapidarius[bee_species$Bombus_lapidarius$Sex == "Female",]$IT~1))[2],b=0,col=3)
#5
plot(BT_IT,main="Bombus terrestris",ylab = "",xlab="")
abline(a=BT_IT[83],b=0,col=2)
abline(a=confint(lm(bee_species$Bombus_terrestris[bee_species$Bombus_terrestris$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Bombus_terrestris[bee_species$Bombus_terrestris$Sex == "Female",]$IT~1))[2],b=0,col=3)

#WEIGHT
#1
plot(AF_WT,main="",ylab = "Dry weight (mg)",xlab="")
abline(a=AF_WT[72],b=0,col=2)
abline(a=confint(lm(bee_species$Andrena_flavipes[bee_species$Andrena_flavipes$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Andrena_flavipes[bee_species$Andrena_flavipes$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)

#2
plot(AN_WT,main="",ylab = "",xlab="")
abline(a=AN_WT[52],b=0,col=2)
abline(a=confint(lm(bee_species$Andrena_nigroaenea[bee_species$Andrena_nigroaenea$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Andrena_nigroaenea[bee_species$Andrena_nigroaenea$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)
#3
plot(BI_WT,main="",ylab = "",xlab="")
abline(a=BI_WT[68],b=0,col=2)
abline(a=confint(lm(bee_species$Bombus_impatiens[bee_species$Bombus_impatiens$Sex == "Male",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Bombus_impatiens[bee_species$Bombus_impatiens$Sex == "Male",]$Spec.wgt~1))[2],b=0,col=3)
#4
plot(BL_WT,main="",ylab = "",xlab="")
abline(a=BL_WT[56],b=0,col=2)
abline(a=confint(lm(bee_species$Bombus_lapidarius[bee_species$Bombus_lapidarius$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Bombus_lapidarius[bee_species$Bombus_lapidarius$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)
#5
plot(BT_WT,main="",ylab = "",xlab="")
abline(a=BT_WT[83],b=0,col=2)
abline(a=confint(lm(bee_species$Bombus_terrestris[bee_species$Bombus_terrestris$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Bombus_terrestris[bee_species$Bombus_terrestris$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)

#Homalictus urbanus
#Lasioglossum_glabriusculum
#Lasioglossum lanarium
#Lasioglossum pauxillum
#Trigona_spinipes
#####IT
#6
plot(HU_IT,main="Homalictus urbanus",ylab = "ITD (mm)",xlab="")
abline(a=HU_IT[211],b=0,col=2)
abline(a=confint(lm(bee_species$Homalictus_urbanus[bee_species$Homalictus_urbanus$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Homalictus_urbanus[bee_species$Homalictus_urbanus$Sex == "Female",]$IT~1))[2],b=0,col=3)

#7
plot(LG_IT,main="Lasioglossum glabriusculum",ylab = "",xlab="")
abline(a=LG_IT[49],b=0,col=2)
abline(a=confint(lm(bee_species$Lasioglossum_glabriusculum[bee_species$Lasioglossum_glabriusculum$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Lasioglossum_glabriusculum[bee_species$Lasioglossum_glabriusculum$Sex == "Female",]$IT~1))[2],b=0,col=3)
#8
plot(LL_IT,main="Lasioglossum lanarium",ylab = "",xlab="")
abline(a=LL_IT[63],b=0,col=2)
abline(a=confint(lm(bee_species$Lasioglossum_lanarium[bee_species$Lasioglossum_lanarium$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Lasioglossum_lanarium[bee_species$Lasioglossum_lanarium$Sex == "Female",]$IT~1))[2],b=0,col=3)
#9
plot(LP_IT,main="Lasioglossum pauxillum",ylab = "",xlab="")
abline(a=LP_IT[131],b=0,col=2)
abline(a=confint(lm(bee_species$Lasioglossum_pauxillum[bee_species$Lasioglossum_pauxillum$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Lasioglossum_pauxillum[bee_species$Lasioglossum_pauxillum$Sex == "Female",]$IT~1))[2],b=0,col=3)
#10
plot(TS_IT,main="Trigona spinipes",ylab = "",xlab="")
abline(a=TS_IT[50],b=0,col=2)
abline(a=confint(lm(bee_species$Trigona_spinipes[bee_species$Trigona_spinipes$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Trigona_spinipes[bee_species$Trigona_spinipes$Sex == "Female",]$IT~1))[2],b=0,col=3)

#WEIGHT
#6
plot(HU_WT,main="",ylab = "Dry weight (mg)",xlab="Sample size (n)")
abline(a=HU_WT[211],b=0,col=2)
abline(a=confint(lm(bee_species$Homalictus_urbanus[bee_species$Homalictus_urbanus$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Homalictus_urbanus[bee_species$Homalictus_urbanus$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)

#7
plot(LG_WT,main="",ylab = "",xlab="Sample size (n)")
abline(a=LG_WT[49],b=0,col=2)
abline(a=confint(lm(bee_species$Lasioglossum_glabriusculum[bee_species$Lasioglossum_glabriusculum$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Lasioglossum_glabriusculum[bee_species$Lasioglossum_glabriusculum$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)
#8
plot(LL_WT,main="",ylab = "",xlab="Sample size (n)")
abline(a=LL_WT[63],b=0,col=2)
abline(a=confint(lm(bee_species$Lasioglossum_lanarium[bee_species$Lasioglossum_lanarium$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Lasioglossum_lanarium[bee_species$Lasioglossum_lanarium$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)
#9
plot(LP_WT,main="",ylab = "",xlab="Sample size (n)")
abline(a=LP_WT[131],b=0,col=2)
abline(a=confint(lm(bee_species$Lasioglossum_pauxillum[bee_species$Lasioglossum_pauxillum$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Lasioglossum_pauxillum[bee_species$Lasioglossum_pauxillum$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)
#10
plot(TS_WT,main="",ylab = "",xlab="Sample size (n)")
abline(a=TS_WT[50],b=0,col=2)
abline(a=confint(lm(bee_species$Trigona_spinipes[bee_species$Trigona_spinipes$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(bee_species$Trigona_spinipes[bee_species$Trigona_spinipes$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)


```

##Hoverfly intraspecific variation with sample size

```{r,echo=FALSE}

set.seed(123)
##ONE##
#Austrosyrphus 
HAA_IT = c()
for(i in 1:length(hov_species$Austrosyphus_aussp1[hov_species$Austrosyphus_aussp1$Sex == "Female",]$IT)){
  subset1 = sample(hov_species$Austrosyphus_aussp1[hov_species$Austrosyphus_aussp1$Sex == "Female",]$IT, i)
  HAA_IT[i] = mean(subset1)
}


#Specimen weight
HAA_WT = c()
for(i in 1:length(hov_species$Austrosyphus_aussp1[hov_species$Austrosyphus_aussp1$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(hov_species$Austrosyphus_aussp1[hov_species$Austrosyphus_aussp1$Sex == "Female",]$Spec.wgt, i)
  HAA_WT[i] = mean(subset1)
}
##TWO##
#Helophilus_parallelus
#IT
HHP_IT = c()
for(i in 1:length(hov_species$Helophilus_parallelus[hov_species$Helophilus_parallelus$Sex == "Female",]$IT)){
  subset1 = sample(hov_species$Helophilus_parallelus[hov_species$Helophilus_parallelus$Sex == "Female",]$IT, i)
  HHP_IT[i] = mean(subset1)
}

#Specimen weight
HHP_WT = c()
for(i in 1:length(hov_species$Helophilus_parallelus[hov_species$Helophilus_parallelus$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(hov_species$Helophilus_parallelus[hov_species$Helophilus_parallelus$Sex == "Female",]$Spec.wgt, i)
  HHP_WT[i] = mean(subset1)
}


##THREE

#Sphaerophoria_macrogaster
#IT
HSM_IT = c()
for(i in 1:length(hov_species$Sphaerophoria_macrogaster[hov_species$Sphaerophoria_macrogaster$Sex == "Female",]$IT)){
  subset1 = sample(hov_species$Sphaerophoria_macrogaster[hov_species$Sphaerophoria_macrogaster$Sex == "Female",]$IT, i)
  HSM_IT[i] = mean(subset1)
}

#Specimen weight
HSM_WT = c()
for(i in 1:length(hov_species$Sphaerophoria_macrogaster[hov_species$Sphaerophoria_macrogaster$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(hov_species$Sphaerophoria_macrogaster[hov_species$Sphaerophoria_macrogaster$Sex == "Female",]$Spec.wgt, i)
  HSM_WT[i] = mean(subset1)
}

##FOUR##
#Episyrphus_balteatus
HEB_IT = c()
for(i in 1:length(hov_species$Episyrphus_balteatus[hov_species$Episyrphus_balteatus$Sex == "Female",]$IT)){
  subset1 = sample(hov_species$Episyrphus_balteatus[hov_species$Episyrphus_balteatus$Sex == "Female",]$IT, i)
  HEB_IT[i] = mean(subset1)
}

#Specimen weight
HEB_WT = c()
for(i in 1:length(hov_species$Episyrphus_balteatus[hov_species$Episyrphus_balteatus$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(hov_species$Episyrphus_balteatus[hov_species$Episyrphus_balteatus$Sex == "Female",]$Spec.wgt, i)
  HEB_WT[i] = mean(subset1)
}

##FIVE##
#Melanostoma_scalare
#IT
HMS_IT = c()
for(i in 1:length(hov_species$Melanostoma_scalare[hov_species$Melanostoma_scalare$Sex == "Female",]$IT)){
  subset1 = sample(hov_species$Melanostoma_scalare[hov_species$Melanostoma_scalare$Sex == "Female",]$IT, i)
  HMS_IT[i] = mean(subset1)
}

#Specimen weight
HMS_WT = c()
for(i in 1:length(hov_species$Melanostoma_scalare[hov_species$Melanostoma_scalare$Sex == "Female",]$Spec.wgt)){
  subset1 = sample(hov_species$Melanostoma_scalare[hov_species$Melanostoma_scalare$Sex == "Female",]$Spec.wgt, i)
  HMS_WT[i] = mean(subset1)
}




##graphed three for aesthetics based on size range
par(mfrow=c(2,5))
par(pty="s")
plot(HAA_IT,main="Austrosyrphus spp.",ylab = "ITD (mm)",xlab="")
abline(a=HAA_IT[32],b=0,col=2)
abline(a=confint(lm(hov_species$Austrosyphus_aussp1[hov_species$Austrosyphus_aussp1$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(hov_species$Austrosyphus_aussp1[hov_species$Austrosyphus_aussp1$Sex == "Female",]$IT~1))[2],b=0,col=3)

plot(HHP_IT,main="Helophilus parallelus",ylab = "",xlab="",ylim=c(3.6,4))
abline(a=HHP_IT[19],b=0,col=2)
abline(a=confint(lm(hov_species$Helophilus_parallelus[hov_species$Helophilus_parallelus$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(hov_species$Helophilus_parallelus[hov_species$Helophilus_parallelus$Sex == "Female",]$IT~1))[2],b=0,col=3)

plot(HEB_IT,main="Episyrphus balteatus",ylab = "",xlab="",ylim=c(2.1,2.55))
abline(a=HEB_IT[11],b=0,col=2)
abline(a=confint(lm(hov_species$Episyrphus_balteatus[hov_species$Episyrphus_balteatus$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(hov_species$Episyrphus_balteatus[hov_species$Episyrphus_balteatus$Sex == "Female",]$IT~1))[2],b=0,col=3)

plot(HSM_IT,main="Sphaerophoria macrogaster",ylab = "",xlab="",ylim=c(1.1,1.5))
abline(a=HSM_IT[10],b=0,col=2)
abline(a=confint(lm(hov_species$Sphaerophoria_macrogaster[hov_species$Sphaerophoria_macrogaster$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(hov_species$Sphaerophoria_macrogaster[hov_species$Sphaerophoria_macrogaster$Sex == "Female",]$IT~1))[2],b=0,col=3)

plot(HMS_IT,main="Melanostoma scalare",ylab = "",xlab="",ylim=c(1.45,1.7))
abline(a=HMS_IT[9],b=0,col=2)
abline(a=confint(lm(hov_species$Melanostoma_scalare[hov_species$Melanostoma_scalare$Sex == "Female",]$IT~1))[1],b=0,col=3)
abline(a=confint(lm(hov_species$Melanostoma_scalare[hov_species$Melanostoma_scalare$Sex == "Female",]$IT~1))[2],b=0,col=3)

plot(HAA_WT,ylab = "Specimen weight (mg)",xlab="Sample size")
abline(a=HAA_WT[32],b=0,col=2)
abline(a=confint(lm(hov_species$Austrosyphus_aussp1[hov_species$Austrosyphus_aussp1$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(hov_species$Austrosyphus_aussp1[hov_species$Austrosyphus_aussp1$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)

plot(HHP_WT,ylab = "",xlab="Sample size",ylim=c(32,42))
abline(a=HHP_WT[19],b=0,col=2)
abline(a=confint(lm(hov_species$Helophilus_parallelus[hov_species$Helophilus_parallelus$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(hov_species$Helophilus_parallelus[hov_species$Helophilus_parallelus$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)

plot(HEB_WT,ylab = "",xlab="Sample size",ylim=c(6,14))
abline(a=HEB_WT[11],b=0,col=2)
abline(a=confint(lm(hov_species$Episyrphus_balteatus[hov_species$Episyrphus_balteatus$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(hov_species$Episyrphus_balteatus[hov_species$Episyrphus_balteatus$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)

plot(HSM_WT,ylab = "",xlab="Sample size",ylim=c(1.2,2))
abline(a=HSM_WT[10],b=0,col=2)
abline(a=confint(lm(hov_species$Sphaerophoria_macrogaster[hov_species$Sphaerophoria_macrogaster$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(hov_species$Sphaerophoria_macrogaster[hov_species$Sphaerophoria_macrogaster$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)

plot(HMS_WT,ylab = "",xlab="Sample size",ylim=c(1.5,6.5))
abline(a=HMS_WT[9],b=0,col=2)
abline(a=confint(lm(hov_species$Melanostoma_scalare[hov_species$Melanostoma_scalare$Sex == "Female",]$Spec.wgt~1))[1],b=0,col=3)
abline(a=confint(lm(hov_species$Melanostoma_scalare[hov_species$Melanostoma_scalare$Sex == "Female",]$Spec.wgt~1))[2],b=0,col=3)

```

##Test of preservative time - Australia and German bees

LME
```{r}

pres.lm=lm(log(Spec.wgt)~log(IT)+Pres.time+Sex+Species,bee_pres)

summary(pres.lm)
plot(pres.lm)
bee_mean[bee_mean$Species=="Andrena_flavipes",]$IT
##Female, IT = 1, Andrena_flavipes, pres time =10
range(bee_pres$IT)

exp(1.27+0.1775480+log(2)*1.85+(0*-0.0012556))-exp(1.27+0.1775480+log(2)*1.85+(100*-0.0012556))
exp(1.27+0.1775480+log(2)*1.85+(0*-0.0012556))-exp(1.27+0.1775480+log(2)*1.85+(50*-0.0012556))
exp(1.27+0.1775480+log(2)*1.85+(0*-0.0012556))-exp(1.27+0.1775480+log(2)*1.85+(1*-0.0012556))
exp(1.27+0.1775480+log(2)*1.85+(0*-0.0012556))

```

```{r}

beeplot1=ggplot(bee_mean,aes(x=log(IT),y=log(Spec.wgt),col=Region))+geom_point(col=1,pch=1)+
  geom_smooth(method="lm",se=FALSE)+theme(aspect.ratio=1)+theme_bw()+
  xlab("Dry weight ln(mg)") + ylab("ITD ln(mm)")
beeplot2=ggplot(bee_mean,aes(x=log(IT),y=log(Spec.wgt),col=Sex))+geom_point(col=1,pch=1)+
  geom_smooth(method="lm",se=FALSE)+theme_bw()+ 
  xlab("Dry weight ln(mg)") + ylab("ITD ln(mm)")
beeplot3=ggplot(bee_mean,aes(x=log(IT),y=log(Spec.wgt),col=Family))+geom_point(col=1,pch=1)+
  geom_smooth(method="lm",se=FALSE)+theme_bw()+ 
  xlab("Dry weight ln(mg)") + ylab("ITD ln(mm)")
  
  
bee1=ggplotGrob(beeplot1)
bee2=ggplotGrob(beeplot2)
bee3=ggplotGrob(beeplot3)
grid.draw(cbind(beeplot1, beeplot2,beeplot3, size = "first"))

hovplot1=ggplot(hov_mean,aes(x=log(IT),y=log(Spec.wgt),col=Region))+geom_point(col=1,pch=1)+
  geom_smooth(method="lm",se=FALSE)+theme(aspect.ratio=1)+theme_bw()+ 
   xlab("Dry weight ln(mg)") + ylab("ITD ln(mm)")
hovplot2=ggplot(hov_mean,aes(x=log(IT),y=log(Spec.wgt),col=Sex))+geom_point(col=1,pch=1)+
  geom_smooth(method="lm",se=FALSE)+theme_bw()+ 
   xlab("Dry weight ln(mg)") + ylab("ITD ln(mm)")
hovplot3=ggplot(hov_mean,aes(x=log(IT),y=log(Spec.wgt),col=Subfamily))+geom_point(col=1,pch=1)+
  geom_smooth(method="lm",se=FALSE)+theme_bw()+ 
 xlab("Dry weight ln(mg)") + ylab("ITD ln(mm)")
  
hov1=ggplotGrob(hovplot1)
hov2=ggplotGrob(hovplot2)
hov3=ggplotGrob(hovplot3)
grid.draw(cbind(hovplot1, hovplot2,hovplot3, size = "first"))
```


###ACTUAL-PREDICTED PLOTS for visual comparison

```{r}
par(pty="s",mfrow=c(2,3))
plot(Spec.wgt~IT,bee_mean[bee_mean$Family=="Apidae" & bee_mean$Sex =="Female",],
       cex=1,pch=8,col="black",main="Apidae",ylim=c(0,800),xlab="ITD (mm)",ylab="Dry weight (mg)")

points(exp(predict(bee2,newdata=bee_mean[bee_mean$Family=="Apidae" & bee_mean$Sex =="Female",]
                 ,re_formula = NA)[,1])~
       bee_mean[bee_mean$Family=="Apidae" & bee_mean$Sex =="Female",]$IT,col="darkblue")
points(exp(predict(bee2,newdata=bee_mean[bee_mean$Family=="Apidae" & bee_mean$Sex =="Female",]
                  )[,1])~
         bee_mean[bee_mean$Family=="Apidae" & bee_mean$Sex =="Female",]$IT,pch=2,col="darkblue")
points(exp(predict(bee_p1,newdata=bee_mean[bee_mean$Family=="Apidae" & bee_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         bee_mean[bee_mean$Family=="Apidae" & bee_mean$Sex =="Female",]$IT,col="darkred")
points(exp(predict(bee_p1,newdata=bee_mean[bee_mean$Family=="Apidae" & bee_mean$Sex =="Female",]
                   )[,1])~
         bee_mean[bee_mean$Family=="Apidae" & bee_mean$Sex =="Female",]$IT,col="darkred",pch=2)


##ANDRENIDAE
plot(Spec.wgt~IT,bee_mean[bee_mean$Family=="Andrenidae" & bee_mean$Sex =="Female",],
     cex=1,pch=8,col="black",main="Andrenidae",xlab="ITD (mm)",ylab="Dry weight (mg)",ylim=c(0,120))
points(exp(predict(bee2,newdata=bee_mean[bee_mean$Family=="Andrenidae" & bee_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         bee_mean[bee_mean$Family=="Andrenidae" & bee_mean$Sex =="Female",]$IT,col="darkblue")
points(exp(predict(bee2,newdata=bee_mean[bee_mean$Family=="Andrenidae" & bee_mean$Sex =="Female",]
                   )[,1])~
         bee_mean[bee_mean$Family=="Andrenidae" & bee_mean$Sex =="Female",]$IT,pch=2,col="darkblue")

points(exp(predict(bee_p1,newdata=bee_mean[bee_mean$Family=="Andrenidae" & bee_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         bee_mean[bee_mean$Family=="Andrenidae" & bee_mean$Sex =="Female",]$IT,col="darkred")
points(exp(predict(bee_p1,newdata=bee_mean[bee_mean$Family=="Andrenidae" & bee_mean$Sex =="Female",]
                   )[,1])~
         bee_mean[bee_mean$Family=="Andrenidae" & bee_mean$Sex =="Female",]$IT,col="darkred",pch=2)

##Colletidae
plot(Spec.wgt~IT,bee_mean[bee_mean$Family=="Colletidae" & bee_mean$Sex =="Female",],
     cex=1,pch=8,col="black",main="Colletidae",ylim=c(0,50),xlab="ITD (mm)",ylab="Dry weight (mg)")
points(exp(predict(bee2,newdata=bee_mean[bee_mean$Family=="Colletidae" & bee_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         bee_mean[bee_mean$Family=="Colletidae" & bee_mean$Sex =="Female",]$IT,col="darkblue")
points(exp(predict(bee2,newdata=bee_mean[bee_mean$Family=="Colletidae" & bee_mean$Sex =="Female",]
                   )[,1])~
         bee_mean[bee_mean$Family=="Colletidae" & bee_mean$Sex =="Female",]$IT,pch=2,col="darkblue")
points(exp(predict(bee_p1,newdata=bee_mean[bee_mean$Family=="Colletidae" & bee_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         bee_mean[bee_mean$Family=="Colletidae" & bee_mean$Sex =="Female",]$IT,col="darkred")
points(exp(predict(bee_p1,newdata=bee_mean[bee_mean$Family=="Colletidae" & bee_mean$Sex =="Female",]
                  )[,1])~
         bee_mean[bee_mean$Family=="Colletidae" & bee_mean$Sex =="Female",]$IT,col="darkred",pch=2)

##Halictidae
plot(Spec.wgt~IT,bee_mean[bee_mean$Family=="Halictidae" & bee_mean$Sex =="Female",],
     cex=1,pch=8,col="black",main="Halictidae",xlab="ITD (mm)",ylab="Dry weight (mg)")
points(exp(predict(bee2,newdata=bee_mean[bee_mean$Family=="Halictidae" & bee_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         bee_mean[bee_mean$Family=="Halictidae" & bee_mean$Sex =="Female",]$IT,col="darkblue")
points(exp(predict(bee2,newdata=bee_mean[bee_mean$Family=="Halictidae" & bee_mean$Sex =="Female",]
                   )[,1])~
         bee_mean[bee_mean$Family=="Halictidae" & bee_mean$Sex =="Female",]$IT,pch=2,col="darkblue")
points(exp(predict(bee_p1,newdata=bee_mean[bee_mean$Family=="Halictidae" & bee_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         bee_mean[bee_mean$Family=="Halictidae" & bee_mean$Sex =="Female",]$IT,col="darkred")
points(exp(predict(bee_p1,newdata=bee_mean[bee_mean$Family=="Halictidae" & bee_mean$Sex =="Female",]
                   )[,1])~
         bee_mean[bee_mean$Family=="Halictidae" & bee_mean$Sex =="Female",]$IT,col="darkred",pch=2)

##Megachilidae
plot(Spec.wgt~IT,bee_mean[bee_mean$Family=="Megachilidae" & bee_mean$Sex =="Female",],
     cex=1,pch=8,col="black",main="Megachilidae",xlab="ITD (mm)",ylab="Dry weight (mg)",ylim=c(0,80))
points(exp(predict(bee2,newdata=bee_mean[bee_mean$Family=="Megachilidae" & bee_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         bee_mean[bee_mean$Family=="Megachilidae" & bee_mean$Sex =="Female",]$IT,col="darkblue")
points(exp(predict(bee2,newdata=bee_mean[bee_mean$Family=="Megachilidae" & bee_mean$Sex =="Female",]
                   )[,1])~
         bee_mean[bee_mean$Family=="Megachilidae" & bee_mean$Sex =="Female",]$IT,pch=2,col="darkblue")
points(exp(predict(bee_p1,newdata=bee_mean[bee_mean$Family=="Megachilidae" & bee_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         bee_mean[bee_mean$Family=="Megachilidae" & bee_mean$Sex =="Female",]$IT,col="darkred")
points(exp(predict(bee_p1,newdata=bee_mean[bee_mean$Family=="Megachilidae" & bee_mean$Sex =="Female",]
                   )[,1])~
         bee_mean[bee_mean$Family=="Megachilidae" & bee_mean$Sex =="Female",]$IT,col="darkred",pch=2)


##Melittidae
plot(Spec.wgt~IT,bee_mean[bee_mean$Family=="Melittidae" & bee_mean$Sex =="Female",],
     cex=1,pch=8,col="black",main="Melittidae",xlab="ITD (mm)",ylab="Dry weight (mg)",ylim=c(0,40))
points(exp(predict(bee2,newdata=bee_mean[bee_mean$Family=="Melittidae" & bee_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         bee_mean[bee_mean$Family=="Melittidae" & bee_mean$Sex =="Female",]$IT,col="darkblue")
points(exp(predict(bee2,newdata=bee_mean[bee_mean$Family=="Melittidae" & bee_mean$Sex =="Female",]
                   )[,1])~
         bee_mean[bee_mean$Family=="Melittidae" & bee_mean$Sex =="Female",]$IT,pch=2,col="darkblue")
points(exp(predict(bee_p1,newdata=bee_mean[bee_mean$Family=="Melittidae" & bee_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         bee_mean[bee_mean$Family=="Melittidae" & bee_mean$Sex =="Female",]$IT,col="darkred")
points(exp(predict(bee_p1,newdata=bee_mean[bee_mean$Family=="Melittidae" & bee_mean$Sex =="Female",]
                  )[,1])~
         bee_mean[bee_mean$Family=="Melittidae" & bee_mean$Sex =="Female",]$IT,col="darkred",pch=2)


##HOVERFLIES

par(mfrow=c(1,2),pty="s")
plot(Spec.wgt~IT,hov_mean[hov_mean$Subfamily=="Syrphinae" & hov_mean$Sex =="Female",],
     cex=1,pch=8,col="black",main="Syrphinae",xlab="ITD (mm)",ylab="Dry weight (mg)",ylim=c(0,40))
points(exp(predict(hov2,newdata=hov_mean[hov_mean$Subfamily=="Syrphinae" & hov_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         hov_mean[hov_mean$Subfamily=="Syrphinae" & hov_mean$Sex =="Female",]$IT,col="darkblue")
points(exp(predict(hov2,newdata=hov_mean[hov_mean$Subfamily=="Syrphinae" & hov_mean$Sex =="Female",]
                   )[,1])~
         hov_mean[hov_mean$Subfamily=="Syrphinae" & hov_mean$Sex =="Female",]$IT,col="darkblue",pch=2)
points(exp(predict(hov7,newdata=hov_mean[hov_mean$Subfamily=="Syrphinae" & hov_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         hov_mean[hov_mean$Subfamily=="Syrphinae" & hov_mean$Sex =="Female",]$IT,col="darkred")
points(exp(predict(hov7,newdata=hov_mean[hov_mean$Subfamily=="Syrphinae" & hov_mean$Sex =="Female",]
                   )[,1])~
         hov_mean[hov_mean$Subfamily=="Syrphinae" & hov_mean$Sex =="Female",]$IT,col="darkred",pch=2)

#Eristalinae
plot(Spec.wgt~IT,hov_mean[hov_mean$Subfamily=="Eristalinae" & hov_mean$Sex =="Female",],
     cex=1,pch=8,col="black",main="Eristalinae",xlab="ITD (mm)",ylab="Dry weight (mg)",ylim=c(0,100))

points(exp(predict(hov2,newdata=hov_mean[hov_mean$Subfamily=="Eristalinae" & hov_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         hov_mean[hov_mean$Subfamily=="Eristalinae" & hov_mean$Sex =="Female",]$IT,col="darkblue")
points(exp(predict(hov2,newdata=hov_mean[hov_mean$Subfamily=="Eristalinae" & hov_mean$Sex =="Female",]
                  )[,1])~
         hov_mean[hov_mean$Subfamily=="Eristalinae" & hov_mean$Sex =="Female",]$IT,col="darkblue",pch=2)
points(exp(predict(hov7,newdata=hov_mean[hov_mean$Subfamily=="Eristalinae" & hov_mean$Sex =="Female",]
                   ,re_formula = NA)[,1])~
         hov_mean[hov_mean$Subfamily=="Eristalinae" & hov_mean$Sex =="Female",]$IT,col="darkred")
points(exp(predict(hov7,newdata=hov_mean[hov_mean$Subfamily=="Eristalinae" & hov_mean$Sex =="Female",]
                  )[,1])~
         hov_mean[hov_mean$Subfamily=="Eristalinae" & hov_mean$Sex =="Female",]$IT,col="darkred",pch=2)


```
##Body length comparison

```{r}
##Relationship between BL AND IT
bee_bl=bee_all[!is.na(bee_all$BL),]
hov_bl=hov_all[!is.na(hov_all$BL),]

###BEES
cor.test(~log(IT)+log(BL),data=bee_bl)

summary(lm( log(Spec.wgt)~ log(BL),bee_bl))
summary(lm( log(Spec.wgt)~ log(IT),bee_bl))



###HOV
cor.test(~log (IT)+log(BL),hov_bl)

summary(lm(log (Spec.wgt)~ log(BL),hov_bl))
summary(lm(log (Spec.wgt)~log (IT),hov_bl))

```

```{r}
lengthsize=function(BL, Eq = "DIP"){
  
if(!Eq %in% c("DIP","HYM","LEP", "S93DB","Sabo02DB", "Sabo02DA", "Sabo02DBB", "R77D",
              "S93DC", "BN06D", "G97D", "GR84D", "JS00DA",
              "S80DCF", "S80DCR", "S80DMF", "S93DA", "W13D", "JS00DN", 
              "S93DN", "Sabo02DN","DIP","Brachycera","Nematocera",
              "Asilidae","Bombyliidae")){
  stop("Equation should be one of 'DIP','HYM','LEP','R77D',
       'S93DB', 'Sabo02DB', 'Sabo02DA', 'Sabo02DBB', 
       'S93DC', 'BN06D', 'G97D', 'GR84D', 'JS00DA', 
       'S80DCF', 'S80DCR', 'S80DMF', 'S93DA', 'W13D', 'JS00DN', 
       'S93DN', 'Sabo02DN','All','Brachycera','Nematocera','Asilidae','Bombyliidae'")
} else {
  S93DB <- exp(-3.374+2.158*log(BL))
  Sabo02DB <- 0.006*(BL)^3.05
  Sabo02DA <- 0.38*(BL)^1.5
  Sabo02DBB <- 0.007*(BL)^3.337
  S93DC <- exp(-3.619+2.632*log(BL))
  BN06D <- exp(-0.041+0.010*(BL))
  G97D <- exp(-3.4294+2.5943*log(BL))
  GR84D <- exp(-3.653+2.546*log(BL))
  JS00DA <- exp(-2.462+1.881*log(BL))
  R77D <- exp(-3.293+2.366*log(BL))
  S80DCF <- exp(log(0.074)+1.64*log(BL))
  S80DCR <- exp(log(0.068)+1.59*log(BL))
  S80DMF <- exp(log(0.022)+2.42*log(BL))
  S93DA <- exp(-3.184+2.23*log(BL))
  W13D <- exp(-3.29+2.65*log(BL))
  JS00DN <- exp(-2.462+1.881*log(BL))
  S93DN <- exp(-3.675+2.212*log(BL))
  Sabo02DN <- 0.1*(BL)^1.57
 
  
  Sabo02HA <- 0.006*(BL)^3.407
  S93HB <- exp(-3.854+2.441*log(BL))
  BN06HF <- exp(log(0.001)+2.33*log(BL))
  GR84F <- exp(-3.997+log(BL)*2.489)
  JS00HF <- exp(-3.730+2.103*log(BL))
  R77A <- exp(-4.029+2.572*log(BL))
  S80FCF <- exp(log(0.012)+2.72*log(BL))
  S80FCR <- exp(log(0.021)+2.31*log(BL))
  S80FMF <- exp(log(0.034)+2.19*log(BL))
  S93HF <- exp(-4.727+2.919*log(BL))
  S93HH <- exp(-2.891+2.302*log(BL))
  S93HI <- exp(-4.149+2.464*log(BL))
  BN06H1 <- exp(-6.783+2.544*log(BL))
  G97H <- exp(-3.5917+2.6429*log(BL))
  G97F <- exp(-3.1415+2.3447*log(BL))
  GR84H <- exp(-2.86+(BL)*0.478)
  JS00HA <- exp(-3.556+2.193*log(BL))
  R77H <- exp(-3.871+2.407*log(BL))
  S80HCF <- exp(log(0.043)+2.07*log(BL))
  S80HCR <- exp(log(0.022)+2.29*log(BL))
  S80HMF <- exp(log(0.016)+2.55*log(BL))
  S93HA <- exp(-4.284+2.696*log(BL))
  Sabo02H <- 0.56*(BL)^1.56
  W13H <- exp(-4.3+3*log(BL))
  S93HP <- exp(-2.341+2.006*log(BL))
  S93HV <- exp(-3.54+2.782*log(BL))
  Sabo02HV <- 0.001*(BL)^3.723
  S93LG <- exp(-4.172+2.628*log(BL))
  S93LM <- exp(-4.913+2.918*log(BL))
  BN06L <- exp(log(0.001)+2.313*log(BL))
  G97L <- exp(-4.7915+2.8585*log(BL))
  JS00L <- exp(-3.268+2.243*log(BL))
  R77L <- exp(-4.037+2.903*log(BL))
  S80LCF <- exp(log(0.026)+2.5*log(BL))
  S80LCR <- exp(log(0.078)+1.32*log(BL))
  S80LMF <- exp(log(0.014)+2.55*log(BL))
  S93LA <- exp(-5.036+3.122*log(BL))
  W13L <- exp(-3.83+2.77*log(BL))
  S93LC <- exp(-3.755+2.658*log(BL))
  S93LN <- exp(-3.337+2.499*log(BL))
  
  
  if (Eq ==  "S93DB") out <- S93DB
  if (Eq == "Sabo02DB") out <- Sabo02DB
  if (Eq == "Sabo02DA") out <- Sabo02DA
  if (Eq == "Sabo02DBB") out <- Sabo02DBB
  if (Eq == "S93DC") out <- S93DC
  if (Eq == "BN06D") out <- BN06D
  if (Eq == "G97D") out <- G97D
  if (Eq == "GR84D") out <- GR84D
  if (Eq == "JS00DA") out <- JS00DA
  if (Eq == "R77D") out <- R77D
  if (Eq == "S80DCF") out <- S80DCF
  if (Eq == "S80DCR") out <- S80DCR
  if (Eq == "S80DMF") out <- S80DMF
  if (Eq == "S93DA") out <- S93DA
  if (Eq == "W13D") out <- W13D
  if (Eq == "JS00DN") out <- JS00DN
  if (Eq == "S93DN") out <- S93DN
  if (Eq == "Sabo02DN") out <- Sabo02DN
  if (Eq == "Brachycera") out <- cbind(S93DB, Sabo02DB)
  if (Eq == "Nematocera") out <- cbind(JS00DN, S93DN, Sabo02DN)
  if (Eq == "Asilidae") out <- cbind(Sabo02DA, S93DB)
  if (Eq == "Bombyliidae") out <-cbind(Sabo02DBB,S93DB)
  if (Eq == "DIP") out <- cbind(BN06D, G97D, GR84D, JS00DA, R77D, S80DCF, S80DCR, S80DMF, S93DA, W13D)
  
  if (Eq ==  "Sabo02HA") out <- Sabo02HA
  if (Eq == "S93HB") out <- S93HB
  if (Eq == "BN06HF") out <- BN06HF
  if (Eq == "GR84F") out <- GR84F
  if (Eq == "JS00HF") out <- JS00HF
  if (Eq == "R77A") out <- R77A
  if (Eq == "S80FCF") out <- S80FCF
  if (Eq == "S80FCR") out <- S80FCR
  if (Eq == "S80FMF") out <- S80FMF
  if (Eq == "S93HF") out <- S93HF
  if (Eq == "S93HH") out <- S93HH
  if (Eq == "S93HI") out <- S93HI
  if (Eq == "BN06H1") out <- BN06H1
  if (Eq == "G97H") out <- G97H
  if (Eq == "G97F") out <- G97F
  if (Eq == "GR84H") out <- GR84H
  if (Eq == "JS00HA") out <- JS00HA
  if (Eq == "R77H") out <- R77H
  if (Eq == "S80HCF") out <- S80HCF
  if (Eq == "S80HCR") out <- S80HCR
  if (Eq == "S80HMF") out <- S80HMF
  if (Eq == "S93HA") out <- S93HA
  if (Eq == "Sabo02H") out <- Sabo02H
  if (Eq == "W13H") out <- W13H
  if (Eq == "S93HP") out <- S93HP
  if (Eq == "S93HV") out <- S93HV
  if (Eq == "Sabo02HV") out <- Sabo02HV
  if (Eq == "Vespidae") out <- cbind(S93HV,Sabo02HV)
  if (Eq == "Formicidae") out <- cbind(BN06HF,GR84F,JS00HF,R77A,S80FCF,S80FCR,S80FMF,S93HF,S93HH,S93HI,BN06H1,G97H,G97F)
  if (Eq == "HYM") out = cbind(BN06H1,G97H, G97F,GR84H,JS00HA,R77H,S80HCF,S80HCR,S80HMF,S93HA,Sabo02H,W13H)
  
  if (Eq ==  "S93LG") out <- S93LG
  if (Eq == "S93LM") out <- S93LM
  if (Eq == "BN06L") out <- BN06L
  if (Eq == "G97L") out <- G97L
  if (Eq == "JS00L") out <- JS00L
  if (Eq == "R77L") out <- R77L
  if (Eq == "S80LCF") out <- S80LCF
  if (Eq == "S80LCR") out <- S80LCR
  if (Eq == "S80LMF") out <- S80LMF
  if (Eq == "S93LA") out <- S93LA
  if (Eq == "W13L") out <- W13L
  if (Eq == "S93LC") out <- S93LC
  if (Eq == "S93LN") out <- S93LN
  if (Eq == "LEP") out <- cbind(BN06L,G97L,JS00L,R77L,S80LCF, S80LCR,S80LMF,S93LA,W13L)
  if (Eq == "Noctuidea") out <- cbind(S93LC, S93LN)
  out
}
} 


#BL analyses


##Pre-existing equations
hov_bl_rmse=cbind(rmse((hov_bl$Spec.wgt),(lengthsize(hov_bl$BL,"DIP")[,1])),
rmse((hov_bl$Spec.wgt),(lengthsize(hov_bl$BL,"DIP")[,2])),
rmse((hov_bl$Spec.wgt),(lengthsize(hov_bl$BL,"DIP")[,3])),
rmse((hov_bl$Spec.wgt),(lengthsize(hov_bl$BL,"DIP")[,4])),
rmse((hov_bl$Spec.wgt),(lengthsize(hov_bl$BL,"DIP")[,5])),
rmse((hov_bl$Spec.wgt),(lengthsize(hov_bl$BL,"DIP")[,6])),
rmse((hov_bl$Spec.wgt),(lengthsize(hov_bl$BL,"DIP")[,7])),
rmse((hov_bl$Spec.wgt),(lengthsize(hov_bl$BL,"DIP")[,8])),
rmse((hov_bl$Spec.wgt),(lengthsize(hov_bl$BL,"DIP")[,9])),
rmse((hov_bl$Spec.wgt),(lengthsize(hov_bl$BL,"DIP")[,10])))

mean(hov_bl_rmse)
7.993184/sqrt(10)
2.527667

bee_bl_rmse=cbind(rmse((bee_bl$Spec.wgt), (lengthsize(bee_bl$BL,"HYM")[,1])),
rmse( (bee_bl$Spec.wgt), (lengthsize(bee_bl$BL,"HYM")[,2])),
rmse( (bee_bl$Spec.wgt), (lengthsize(bee_bl$BL,"HYM")[,3])),
rmse( (bee_bl$Spec.wgt), (lengthsize(bee_bl$BL,"HYM")[,4])),
rmse( (bee_bl$Spec.wgt), (lengthsize(bee_bl$BL,"HYM")[,5])),
rmse( (bee_bl$Spec.wgt), (lengthsize(bee_bl$BL,"HYM")[,6])),
rmse( (bee_bl$Spec.wgt), (lengthsize(bee_bl$BL,"HYM")[,7])),
rmse( (bee_bl$Spec.wgt), (lengthsize(bee_bl$BL,"HYM")[,8])),
rmse( (bee_bl$Spec.wgt), (lengthsize(bee_bl$BL,"HYM")[,9])),
rmse( (bee_bl$Spec.wgt), (lengthsize(bee_bl$BL,"HYM")[,10])),
rmse( (bee_bl$Spec.wgt), (lengthsize(bee_bl$BL,"HYM")[,11])),
rmse( (bee_bl$Spec.wgt), (lengthsize(bee_bl$BL,"HYM")[,12])))

mean(bee_bl_rmse)
36.36586 +- 8.295096
sd(bee_bl_rmse)/sqrt(12)

rmse((bee_all$Spec.wgt),(Cane(IT=bee_all$IT)))
```

#Save data files - rda files
```{r}
bee_tax_mod=bee2
bee_phy_mod=bee_p1
h1=hov2
h2=hov7
bee_IT=bee_p3
hov_IT=hov1
devtools::use_data(bee_tax_mod,bee_phy_mod,bee_IT,h1,h2,hov_IT,
                   internal=TRUE,overwrite = TRUE,compress="xz")

pollimetry_dataset=poll_all
save(pollimetry_dataset,file="pollimetry/data/pollimetry_dataset.rdata",compress="xz")
bee_mean_dataset=bee_mean
save(bee_mean_dataset,file="pollimetry/data/bee_mean_dataset.rdata",compress="xz")
hov_mean_dataset=hov_mean
save(hov_mean_dataset,file="pollimetry/data/hov_mean_dataset.rdata",compress="xz")
```